# StopShorts 習慣化コーチング機能 設計書

> **このドキュメントについて**
> ショート動画の視聴習慣を断ち切るための「習慣化コーチング機能」の設計書です。
> one secアプリの良い点を取り入れつつ、アプリ内訓練モードを組み合わせた設計を記述します。

---

## 概要

### 目的
ショート動画アプリ（TikTok、YouTube Shorts、Instagram Reels）を**無意識に開く習慣**を断ち切り、**意識的な選択**に変える。

### 設計思想
1. **完全ブロックではなく「意識化」** - 使用を禁止するのではなく、使う前に立ち止まらせる
2. **練習による習慣形成** - アプリ内で繰り返し練習することで新しい行動パターンを定着
3. **心理学的根拠に基づく設計** - 行動変容理論を活用

---

## 競合分析: one secアプリ

### one secの仕組み

```
ユーザーがTikTokをタップ
        ↓
DeviceActivityが検知
        ↓
ManagedSettingsでTikTokを即座にブロック
        ↓
one secアプリをフォアグラウンドに起動
        ↓
深呼吸アニメーション（5-10秒）
「本当に開きますか？」の問いかけ
        ↓
[開く] or [やめる] の選択
        ↓
「開く」→ ブロック解除 → TikTokに戻る
「やめる」→ ホーム or 代替アプリへ
```

### one secの優れている点

| 要素 | 説明 | 心理学的根拠 |
|------|------|-------------|
| **意図的な摩擦** | アプリ起動を遅延させる | 自動的な行動を中断し再考の機会を与える |
| **深呼吸ガイダンス** | 5-10秒の呼吸アニメーション | システム1（衝動）→システム2（理性）への切り替え |
| **目的の問いかけ** | 「本当に必要？」と質問 | メタ認知を活性化 |
| **選択肢の提示** | 開く/やめる/代替行動 | 自律性を維持しつつナッジを提供 |
| **統計の可視化** | 阻止した回数、節約時間を表示 | 自己効力感の向上 |
| **カスタマイズ性** | 遅延時間、対象アプリを設定可能 | 個人のニーズに適合 |

### one secの改善の余地

| 課題 | 説明 |
|------|------|
| **慣れの問題** | 長期使用で介入に慣れ、効果が薄れる |
| **初期設定の複雑さ** | iOSショートカット設定が難しい |
| **ユーザー依存** | 本人のコミットメントがないと効果なし |
| **受動的** | 介入を受けるだけで、能動的な訓練がない |

---

## StopShortsの差別化ポイント

### 1. アプリ内訓練モード（案C）

one secにない機能として、**アプリ内で習慣を「練習」できる**仕組みを追加。

**コンセプト:**
- StopShorts内にTikTok風のモックUIを再現
- ユーザーにスワイプさせ、介入を体験させる
- 繰り返し練習することで「スワイプ→止まる」を条件付け

### 2. 能動的な習慣形成

one secは**受動的**（介入を受ける）だが、StopShortsは**能動的**（自ら練習する）。

| アプローチ | one sec | StopShorts |
|-----------|---------|------------|
| 介入タイミング | アプリ起動時のみ | 起動時 + アプリ内訓練 |
| ユーザーの姿勢 | 受動的（介入される） | 能動的（練習する） |
| 習慣形成 | 間接的 | 直接的 |
| 慣れへの対策 | なし | 訓練バリエーション |

---

## 機能設計

### 機能1: one sec方式の起動時介入

#### フロー

```
[ユーザーがTikTokをタップ]
        ↓
[DeviceActivity検知]
        ↓
[ManagedSettingsでブロック]
        ↓
[StopShortsをフォアグラウンドに起動]
        ↓
┌─────────────────────────────┐
│                             │
│   ⏸️ ちょっと待って         │
│                             │
│   ○                        │  ← 呼吸アニメーション
│   吸って... 吐いて...        │
│                             │
│   TikTokを開こうとしています │
│   本当に必要ですか？         │
│                             │
│   ┌──────────┐ ┌──────────┐ │
│   │  やめる   │ │  開く    │ │
│   └──────────┘ └──────────┘ │
│                             │
│   今日の記録: 3回やめた      │
│                             │
└─────────────────────────────┘
```

#### 設計詳細

| 要素 | 仕様 |
|------|------|
| 呼吸時間 | デフォルト5秒（設定で3-10秒に変更可） |
| 問いかけ | 「本当に必要ですか？」（カスタマイズ可） |
| 選択肢 | やめる / 開く / [設定した代替行動] |
| 統計表示 | 今日やめた回数、今週の節約時間 |

#### 「やめる」選択時の追加オプション

```
┌─────────────────────────────┐
│                             │
│   ✓ よく頑張りました！       │
│                             │
│   代わりに何をしますか？     │
│                             │
│   ┌─────────────────────┐   │
│   │ 📖 読書をする        │   │  ← オンボーディングで設定した代替行動
│   └─────────────────────┘   │
│                             │
│   ┌─────────────────────┐   │
│   │ 🏠 ホームに戻る      │   │
│   └─────────────────────┘   │
│                             │
│   🔥 3日連続で衝動を抑えた！ │  ← ストリーク表示
│                             │
└─────────────────────────────┘
```

---

### 機能2: アプリ内訓練モード

#### コンセプト

実際のTikTokでは介入できないため、**StopShorts内でTikTok風のUIを再現**し、そこで「スワイプ→止まる」を練習させる。

**心理学的根拠:**
- **イメージトレーニング** - 実際の状況を模擬することで本番での対応力が向上
- **条件付け** - 繰り返しにより「スワイプ→深呼吸」の神経回路を形成
- **自己効力感** - 練習で成功体験を積み、実際の場面でも「できる」と感じる

#### フロー

```
[メイン画面から「訓練モード」を選択]
        ↓
┌─────────────────────────────┐
│  訓練モード                  │
│                             │
│  ショート動画を見る状況を    │
│  シミュレーションします。    │
│                             │
│  ↕ スワイプして進んでください │
│                             │
│   ┌─────────────────────┐   │
│   │      始める          │   │
│   └─────────────────────┘   │
└─────────────────────────────┘
        ↓
┌─────────────────────────────┐
│                             │
│   [モック動画サムネイル]     │  ← TikTok風UI
│                             │
│   🐵 チャンネル名            │  ← mock-channel-icon.png使用
│   ♡ 1.2K  💬 234  ↗ 56     │
│                             │
│   ↕ スワイプで次へ           │
│                             │
│      ● ○ ○ ○ ○              │
└─────────────────────────────┘
        ↓
    [3-5回スワイプ後]
        ↓
┌─────────────────────────────┐
│                             │
│   ⏸️ ストップ               │  ← 全画面介入
│                             │
│   ○                        │
│   深呼吸してください         │
│                             │
│   [  ●  ○  ○  ]             │  ← 3回呼吸カウンター
│                             │
└─────────────────────────────┘
        ↓
    [呼吸完了後]
        ↓
┌─────────────────────────────┐
│                             │
│   ✓ 完了！                  │
│                             │
│   この感覚を覚えておいて     │
│   ください。                 │
│                             │
│   実際のアプリでも、         │
│   同じように止まりましょう。  │
│                             │
│   ┌─────────────────────┐   │
│   │    もう一度練習       │   │
│   └─────────────────────┘   │
│   ┌─────────────────────┐   │
│   │      終了            │   │
│   └─────────────────────┘   │
│                             │
│   今日の訓練: 3回完了        │
└─────────────────────────────┘
```

#### 訓練バリエーション

慣れを防ぐため、複数の訓練パターンを用意:

| パターン | 説明 | 目的 |
|----------|------|------|
| **基本訓練** | X回スワイプ後に深呼吸 | 基本的な条件付け |
| **ランダム介入** | ランダムなタイミングで介入 | 予測不能性で効果維持 |
| **目的確認訓練** | 介入時に「何をしたかったか」を入力 | メタ認知の強化 |
| **代替行動訓練** | 介入後に代替行動を実際に行う | 習慣置換の練習 |
| **時間制限訓練** | 30秒間スワイプ→強制終了 | 時間感覚の養成 |

#### 進捗システム

```
┌─────────────────────────────┐
│  訓練の記録                  │
│                             │
│  🔥 5日連続訓練中            │
│                             │
│  今週の訓練                  │
│  ████████░░ 8/10回          │
│                             │
│  累計                       │
│  ・訓練完了: 42回            │
│  ・衝動を抑えた: 156回       │
│  ・節約時間: 約8時間         │
│                             │
└─────────────────────────────┘
```

---

### 機能3: 5分シールド（既存機能）

#### 概要
ショート動画アプリを5分使用すると、シールド画面を表示。

#### フロー

```
[DeviceActivityで5分使用を検知]
        ↓
[ManagedSettingsでブロック]
        ↓
[StopShortsをフォアグラウンドに起動]
        ↓
┌─────────────────────────────┐
│                             │
│   ⏱️ 5分経ちました          │
│                             │
│   今日の使用時間: 23分       │
│                             │
│   ─────────────────         │
│                             │
│   続けますか？              │
│                             │
│   ┌──────────┐ ┌──────────┐ │
│   │ 終わる   │ │ あと5分  │ │
│   └──────────┘ └──────────┘ │
│                             │
│   💡 あと5分を選ぶと         │
│   今日3回目です              │
│                             │
└─────────────────────────────┘
```

---

## 機能間の連携

```
┌─────────────────────────────────────────────────────┐
│                    StopShorts                       │
├─────────────────────────────────────────────────────┤
│                                                     │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐ │
│  │ 起動時介入   │  │ アプリ内訓練 │  │ 5分シールド │ │
│  │ (one sec式) │  │ (練習モード) │  │ (時間制限)  │ │
│  └──────┬──────┘  └──────┬──────┘  └──────┬──────┘ │
│         │               │               │         │
│         └───────────────┼───────────────┘         │
│                         ↓                         │
│              ┌─────────────────┐                  │
│              │   共通の統計    │                  │
│              │ ・抑えた回数    │                  │
│              │ ・節約時間      │                  │
│              │ ・ストリーク    │                  │
│              └─────────────────┘                  │
│                         ↓                         │
│              ┌─────────────────┐                  │
│              │   モチベーション │                  │
│              │ ・進捗表示      │                  │
│              │ ・達成バッジ    │                  │
│              │ ・週間レポート  │                  │
│              └─────────────────┘                  │
│                                                     │
└─────────────────────────────────────────────────────┘
```

---

## 心理学的根拠まとめ

| 理論 | 適用箇所 | 説明 |
|------|----------|------|
| **二重過程理論** | 起動時介入、訓練 | 衝動的なシステム1から理性的なシステム2への切り替えを促す |
| **習慣ループ** | 全機能 | キュー→ルーティン→報酬のループを中断・置換 |
| **条件付け** | 訓練モード | スワイプ→深呼吸の神経回路を形成 |
| **自己効力感** | 統計、進捗 | 成功体験の積み重ねで「自分はできる」という感覚を強化 |
| **マインドフルネス** | 深呼吸 | 現在の瞬間に意識を向け、衝動から距離を置く |
| **ナッジ理論** | 代替行動提示 | 選択の自由を維持しつつ、良い選択を促す |
| **コミットメントデバイス** | 5分シールド | 将来の自分を制約することで目標達成を支援 |

---

## 技術的実装要件

### Screen Time API

| フレームワーク | 用途 |
|---------------|------|
| `FamilyControls` | 権限取得、対象アプリ選択 |
| `DeviceActivity` | アプリ起動・使用時間の検知 |
| `ManagedSettings` | アプリのブロック・解除 |

### 必要なエンタイトルメント

```
com.apple.developer.family-controls
```

> ⚠️ **注意**: Family Controls entitlementはAppleへの申請・承認が必要

### 主要な実装タスク

1. [ ] DeviceActivityMonitor拡張の実装
2. [ ] ShieldConfiguration / ShieldAction の実装
3. [ ] アプリ内訓練UIの実装（TikTok風モックUI）
4. [ ] 統計・進捗トラッキングの実装
5. [ ] 設定画面の実装

---

## ダッシュボード設定

### 介入パターンのカスタマイズ

ユーザーがダッシュボードから介入パターンを選択可能。

```
┌─────────────────────────────────────┐
│  介入設定                            │
│                                     │
│  介入パターン                        │
│  ┌─────────────────────────────┐   │
│  │ ○ やさしめ（3段階）          │   │
│  │   1回目: 閉じるのみ           │   │
│  │   2回目: 閉じる + StopShorts  │   │
│  │   3回目: StopShortsのみ       │   │
│  └─────────────────────────────┘   │
│  ┌─────────────────────────────┐   │
│  │ ● 標準（2段階）← デフォルト   │   │
│  │   1回目: 閉じる + StopShorts  │   │
│  │   2回目: StopShortsのみ       │   │
│  └─────────────────────────────┘   │
│  ┌─────────────────────────────┐   │
│  │ ○ 厳格（即時強制）           │   │
│  │   1回目から: StopShortsのみ   │   │
│  └─────────────────────────────┘   │
│                                     │
│  ─────────────────────────────      │
│                                     │
│  介入タイミング                      │
│                                     │
│  1回目の介入  [  5  ] 分後          │
│  2回目の介入  [ 10  ] 分後          │
│  3回目の介入  [ 15  ] 分後          │
│                                     │
└─────────────────────────────────────┘
```

### 介入パターン詳細

| パターン | 1回目 | 2回目 | 3回目以降 | 対象ユーザー |
|----------|-------|-------|----------|-------------|
| **やさしめ** | 閉じるのみ | 閉じる + StopShorts | StopShortsのみ | 初心者向け |
| **標準** | 閉じる + StopShorts | StopShortsのみ | StopShortsのみ | 一般ユーザー |
| **厳格** | StopShortsのみ | StopShortsのみ | StopShortsのみ | 本気でやめたい人 |

---

## 課金モデル

### Apple App Store ガイドライン準拠

Screen Time API を使用するアプリでの有料サブスクリプション（無料トライアルあり）は
Apple ガイドラインに準拠しており、one sec、Opal、ScreenZen 等の既存アプリも同様のモデルを採用。

### プラン構成

> **参照**: 詳細は `docs/specs/02_pricing_monetization.md` を参照

#### オンボーディング後のプラン選択画面

```
┌─────────────────────────────────────┐
│                                     │
│  プランを選択                        │
│                                     │
│  ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━   │
│                                     │
│  まずは無料で試す                    │
│  ┌─────────────────────────────┐   │
│  │  🎁 1日フル体験（無料）       │   │
│  │                             │   │
│  │  全機能を1日間お試し         │   │
│  │  クレジットカード登録不要     │   │
│  │                             │   │
│  │  [  無料で始める  ]          │   │
│  └─────────────────────────────┘   │
│                                     │
│  ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━   │
│                                     │
│  今すぐコミットする                  │
│  トライアルなしで本気で始める方へ     │
│                                     │
│  ┌─────────────────────────────┐   │
│  │  ⭐ 90日マスター（おすすめ）  │   │
│  │                             │   │
│  │  ¥1,980（1日22円）           │   │
│  │                             │   │
│  │  習慣形成に最適な期間         │   │
│  │  週次フィードバック付き       │   │
│  │                             │   │
│  │  [  90日で始める  ]          │   │
│  └─────────────────────────────┘   │
│                                     │
│  ┌─────────────────────────────┐   │
│  │  📅 30日チャレンジ           │   │
│  │                             │   │
│  │  ¥980（1日33円）             │   │
│  │                             │   │
│  │  まずは30日から始める         │   │
│  │                             │   │
│  │  [  30日で始める  ]          │   │
│  └─────────────────────────────┘   │
│                                     │
│  ┌─────────────────────────────┐   │
│  │  👑 年間プラン               │   │
│  │                             │   │
│  │  ¥3,980（1日11円）           │   │
│  │  49%OFF                     │   │
│  │                             │   │
│  │  [  年間で始める  ]          │   │
│  └─────────────────────────────┘   │
│                                     │
│  ─────────────────────────────      │
│  利用規約 | プライバシーポリシー     │
│                                     │
└─────────────────────────────────────┘
```

### プラン比較

| プラン | 価格 | 1日あたり | 特徴 |
|--------|------|----------|------|
| **機能制限版** | 無料 | - | 1日1回の遮断のみ、1アプリのみ |
| **1日フル体験** | 無料 | - | 全機能お試し、クレカ登録不要 |
| **30日チャレンジ** | ¥980 | ¥33 | 基本コーチング付き |
| **90日マスター** | ¥1,980 | ¥22 | 週次フィードバック、達成レポート |
| **年間プラン** | ¥3,980 | ¥11 | 最もお得（49%OFF）、優先サポート |

### 90日マスターがおすすめの理由

- **習慣形成の研究**: 新しい習慣の定着には平均66日かかる（Lally et al., 2010）
- **コミットメント効果**: 前払いすることで継続のモチベーションが高まる
- **週次フィードバック**: 30日プランにはない継続サポート
- **コスパ**: 30日×3回より33%お得

### Apple ガイドライン遵守事項

| 要件 | 対応 |
|------|------|
| **価格の明示** | 全プランの価格を明確に表示 |
| **自動更新の説明** | トライアル後の自動更新を明記 |
| **キャンセル方法** | いつでもキャンセル可能と明記 |
| **トライアル条件** | 3日間、全機能利用可能と明記 |
| **プライバシー** | リンクを表示 |

---

## オンボーディングとの連携

オンボーディングの **Step 8: How It Works** で、訓練モードを実際に体験させる。
**Step 9: Start** でプラン選択画面を表示。

→ 詳細は `docs/ONBOARDING_FLOW.md` を参照

---

## 変更履歴

| 日付 | 変更内容 |
|------|----------|
| 2024-12-20 | 初版作成 |
| 2024-12-20 | ダッシュボード設定（介入パターン選択）を追加 |
| 2024-12-20 | 課金モデルを追加（02_pricing_monetization.md に準拠） |

---

## 次のステップ

1. [ ] この設計書をレビュー
2. [ ] Family Controls entitlementの申請
3. [ ] DeviceActivity拡張のプロトタイプ実装
4. [ ] アプリ内訓練UIのプロトタイプ実装
5. [ ] ユーザーテストで効果検証

