# StopShorts Project Review (Codebase-wide)

Date: 2025-12-21
Reviewer: Codex
Scope: app/, src/, modules/, docs (architecture, correctness, risks, testability)

---

## Findings (ordered by severity)

### High
1) Android usage/monitoring data paths are fragmented across three stores and two data sources
   - `useAppStore.stats`, `useStatisticsStore`, and `useScreenTimeData` are all used in dashboards with different semantics.
   - This makes correctness and reconciliation of “usage”, “interventions”, and “saved time” ambiguous.
   - Evidence: `app/(main)/index.tsx`, `app/(main)/statistics.tsx`, `src/stores/useAppStore.ts`, `src/stores/useStatisticsStore.ts`, `src/hooks/useScreenTimeData.ts`.

2) Monitoring service events do not enrich stats with app/time metadata
   - Native event includes `appPackage` and `timestamp`, but `recordIntervention` stores only `proceeded`.
   - This blocks per-app/time-of-day analytics even though downstream UI suggests it.
   - Evidence: `modules/screen-time-android/.../CheckinForegroundService.kt`, `ScreenTimeAndroidModule.kt`, `src/hooks/useMonitoringService.ts`, `src/stores/useStatisticsStore.ts`.

### Medium
3) Onboarding and main flows use different “source of truth” for selected apps
   - Monitoring uses selected apps + custom apps; usage stats also include defaults, regardless of user unselect.
   - Risk: user deselects an app but still sees it in usage stats.
   - Evidence: `src/hooks/useMonitoringService.ts`, `src/hooks/useScreenTimeData.ts`, `src/native/ScreenTimeModule.ts`.

4) Deep link integration depends on scheme routing not documented/tested in app config
   - `stopshorts://urge-surfing?...` is used, but no explicit link configuration in docs.
   - Risk: deep link fails silently on some devices/builds.
   - Evidence: `app/(main)/urge-surfing.tsx`, `modules/screen-time-android/.../CheckinForegroundService.kt`.

5) Heavy debug logging in production paths
   - Native usage stats functions log per-app data and timestamps, potentially noisy and privacy-sensitive.
   - Risk: log spam, performance, data exposure in release builds.
   - Evidence: `modules/screen-time-android/.../UsageStatsTracker.kt`, `ScreenTimeAndroidModule.kt`.

### Low
6) Demo/placeholder values remain in UI logic
   - Demo banners and fallback values are still used in some screens, even on Android.
   - Risk: confusion in real user tests if permissions fail or data is 0.
   - Evidence: `app/(main)/index.tsx`, `app/(main)/statistics.tsx`.

7) App icon in foreground service uses system icon
   - Notification icon uses `android.R.drawable.ic_menu_view`.
   - Risk: looks unpolished; Play review may note branding inconsistency.
   - Evidence: `modules/screen-time-android/.../CheckinForegroundService.kt`.

---

## Open Questions / Assumptions
- Is the intended “source of truth” for analytics `useStatisticsStore` or `useAppStore.stats`?
- Should usage analytics reflect only selected apps, or all target defaults regardless of user selection?
- Where is deep link handling configured for production (app.json / Android intent filter)?

---

## Suggested Next Steps
1) Consolidate analytics into a single store (prefer `useStatisticsStore`) and deprecate legacy `useAppStore.stats` usage.
2) Extend `recordIntervention` to accept `appPackage` and `timestamp`, and update UI aggregations accordingly.
3) Make selected app filtering consistent between monitoring and usage aggregation.
4) Add explicit deep link configuration and document it.
5) Gate verbose native logs behind a debug flag for release builds.

---

## Files Reviewed (high signal)
- `app/(main)/index.tsx`
- `app/(main)/statistics.tsx`
- `app/(main)/urge-surfing.tsx`
- `app/(onboarding)/*`
- `src/hooks/useMonitoringService.ts`
- `src/hooks/useScreenTimeData.ts`
- `src/stores/useAppStore.ts`
- `src/stores/useStatisticsStore.ts`
- `src/native/ScreenTimeModule.ts`
- `modules/screen-time-android/android/src/main/java/com/stopshorts/screentime/*.kt`

