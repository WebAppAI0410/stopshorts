# StopShorts Project Review

Date: 2025-12-19
Reviewer: Codex (with skills-assisted review)
Scope: app/, src/, modules/, docs (implementation vs. requirements, core flows)
Context: Screen Time / Family Controls features are mocked pending Apple entitlement.

## Skills / Sub-agents Used
- code-review-excellence: review structure and risk triage
- react-native-expo: RN/Expo-specific correctness and platform constraints
- nextjs / ui-design-system: UI consistency and design-system alignment
- mcp-integration: native module boundaries and integration risks

## Findings (ordered by severity)

### High
1) Screen Time core logic is UI-only and not connected to the real trigger path
   - Impact: core value (“5-minute block”) cannot be validated end-to-end; risk of late integration surprises
   - Evidence: `modules/screen-time/src/ScreenTimeModule.swift` provides auth + clear only; no DeviceActivityMonitor scheduling or shield trigger; `app/(main)/shield.tsx` is standalone UI without trigger
   - Files: `modules/screen-time/src/ScreenTimeModule.swift`, `app/(main)/shield.tsx`, `src/services/screenTime.ts`

2) Purpose/intent models are diverged across onboarding vs. personalization
   - Impact: personalization may be inconsistent or defaulted (purpose not set); intent messaging may not reflect onboarding choices
   - Evidence: onboarding uses `GoalType` + `MotivationType` + `IfThenPlan`; personalization uses `UserPurpose` + `ImplementationIntentConfig`
   - Files: `app/(onboarding)/goal.tsx`, `app/(onboarding)/motivation.tsx`, `app/(onboarding)/if-then.tsx`, `src/services/personalization.ts`, `src/types/index.ts`, `src/stores/useAppStore.ts`

### Medium
3) Stats/analytics screens rely on placeholders/random values when data is missing
   - Impact: product metrics appear valid but are synthetic; potential confusion during user testing
   - Evidence: `statistics.tsx` uses random values when no `stats` exist; `index.tsx` streak is placeholder
   - Files: `app/(main)/statistics.tsx`, `app/(main)/index.tsx`

4) Onboarding flow is v3 (10 steps) but docs/requirements indicate older flow
   - Impact: docs/users may follow the wrong flow; QA may use outdated acceptance criteria
   - Evidence: progress is 10 steps in UI; requirements mention 3-screen value prop and different step names
   - Files: `app/(onboarding)/*.tsx`, `docs/specs/01_requirements.md`, `docs/ROADMAP.md`, `docs/ONBOARDING_FLOW.md`

### Low
5) FORCE_ONBOARDING resets state on every dev run
   - Impact: development convenience only, but may mask state-related bugs if left on accidentally
   - Evidence: `const FORCE_ONBOARDING = __DEV__ && true;`
   - Files: `app/index.tsx`

6) Mixed language strings in UI (JP/EN) without consistent i18n coverage
   - Impact: inconsistent UX polish; localization strategy unclear
   - Evidence: several hardcoded English strings remain
   - Files: `app/(main)/index.tsx`, `app/(main)/statistics.tsx`

## Open Questions / Assumptions
- Will the real Screen Time trigger path be implemented via DeviceActivityMonitor + ManagedSettings shield extensions, or via a different approach?
- Should onboarding capture `UserPurpose` explicitly, or is the new `GoalType/MotivationType` sufficient for v3 personalization?
- What’s the intended strategy for stats when Screen Time is mocked (explicit “demo mode” vs. placeholder data)?

## Suggested Next Steps
1) Define the canonical user intent model and map onboarding → personalization (single source of truth).
2) Add a clear “mock data” mode banner for stats and screen time analysis when entitlement is unavailable.
3) Create a lightweight integration scaffold for Screen Time (even if no entitlement), e.g., stubbed scheduling API paths to ensure app wiring is correct.
4) Align requirements docs to v3 onboarding flow (or add an explicit “v3 supersedes v1” note).

## Files Reviewed (high signal)
- `app/(onboarding)/*`
- `app/(main)/*`
- `src/stores/useAppStore.ts`
- `src/services/screenTime.ts`
- `src/services/personalization.ts`
- `modules/screen-time/*`
- `docs/specs/01_requirements.md`
- `docs/ROADMAP.md`
- `docs/ONBOARDING_FLOW.md`

