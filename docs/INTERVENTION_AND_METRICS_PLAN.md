# ä»‹å…¥ã‚·ã‚¹ãƒ†ãƒ ãƒ»çµ±è¨ˆæŒ‡æ¨™ å®Ÿè£…è¨ˆç”»

**ä½œæˆæ—¥**: 2025-12-22
**æœ€çµ‚æ›´æ–°**: 2025-12-22ï¼ˆCodexæ·»å‰Šåæ˜ ï¼‰
**ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹**: è¨ˆç”»ä¸­

---

## æ¦‚è¦

æœ¬ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã¯ä»¥ä¸‹ã®2ã¤ã®æ©Ÿèƒ½æ”¹å–„ã«ã¤ã„ã¦å®Ÿè£…è¨ˆç”»ã‚’è¨˜è¿°ã™ã‚‹:

1. **ä»‹å…¥ã‚·ã‚¹ãƒ†ãƒ ã®å†è¨­è¨ˆ** - ãƒ¦ãƒ¼ã‚¶ãƒ¼è¨­å®šå¯èƒ½ãªä»‹å…¥ã‚¿ã‚¤ãƒŸãƒ³ã‚°
2. **çµ±è¨ˆæŒ‡æ¨™ã®åˆ·æ–°** - ãƒ¢ãƒãƒ™ãƒ¼ã‚·ãƒ§ãƒ³ã‚’ç¶­æŒã™ã‚‹æ–°ã—ã„æŒ‡æ¨™ã‚·ã‚¹ãƒ†ãƒ 

---

## 1. ä»‹å…¥ã‚·ã‚¹ãƒ†ãƒ 

### 1.1 ç¾çŠ¶ã®å•é¡Œ

ç¾åœ¨ã®å®Ÿè£…:
- Androidã‚ªãƒ¼ãƒãƒ¼ãƒ¬ã‚¤ï¼ˆ`OverlayController.kt`ï¼‰ã§ç°¡æ˜“ãƒ€ã‚¤ã‚¢ãƒ­ã‚°ã‚’è¡¨ç¤º
- ã€Œè¡å‹•ã‚µãƒ¼ãƒ•ã‚£ãƒ³ã‚°ã‚’è©¦ã™ã€ãƒœã‚¿ãƒ³ã§StopShortsã‚¢ãƒ—ãƒªã«é·ç§»
- ä»‹å…¥ç”»é¢ã¨Urge SurfingãŒåˆ†é›¢ã—ã¦ã„ã‚‹

å•é¡Œç‚¹:
- ä»‹å…¥ â†’ ã‚¢ãƒ—ãƒªé·ç§» â†’ Urge Surfing ã¨ã„ã†æµã‚ŒãŒå†—é•·
- iOSã§ã¯å³æ™‚ä»‹å…¥ãŒæŠ€è¡“çš„ã«ä¸å¯èƒ½

### 1.2 æ–°è¨­è¨ˆ

#### ä»‹å…¥ã‚¿ã‚¤ãƒŸãƒ³ã‚°è¨­å®š

```typescript
interface InterventionSettings {
  // ä»‹å…¥ã‚¿ã‚¤ãƒŸãƒ³ã‚°
  timing: 'immediate' | 'delayed';

  // é…å»¶æ™‚é–“ï¼ˆåˆ†ï¼‰- timingãŒ'delayed'ã®å ´åˆã®ã¿æœ‰åŠ¹
  delayMinutes: 5 | 10 | 15;
}

// ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤
const DEFAULT_INTERVENTION_SETTINGS: InterventionSettings = {
  timing: 'immediate',
  delayMinutes: 5,
};
```

#### å‹•ä½œãƒ•ãƒ­ãƒ¼

**å³æ™‚ä»‹å…¥ãƒ¢ãƒ¼ãƒ‰ï¼ˆAndroidï¼‰**
```
ã‚·ãƒ§ãƒ¼ãƒˆå‹•ç”»ã‚¢ãƒ—ãƒªèµ·å‹•æ¤œçŸ¥
    â†“
ã‚ªãƒ¼ãƒãƒ¼ãƒ¬ã‚¤è¡¨ç¤ºï¼ˆUrge Surfingçµ±åˆç‰ˆï¼‰
    â†“
Phase 1: è¡å‹•å¼·åº¦ã‚’è¨˜éŒ²
Phase 2: å‘¼å¸ã‚¬ã‚¤ãƒ‰ï¼ˆ30ç§’ï¼‰
Phase 3: çµæœè¡¨ç¤º â†’ é–‰ã˜ã‚‹ or ã‚¢ãƒ—ãƒªã‚’é–‹ã
```

> âš ï¸ **æŠ€è¡“çš„åˆ¶ç´„**: Android 10+ ã§ã¯ãƒãƒƒã‚¯ã‚°ãƒ©ã‚¦ãƒ³ãƒ‰ã‹ã‚‰ã®Activityèµ·å‹•ãŒåˆ¶é™ã•ã‚Œã‚‹ãŸã‚ã€
> ã‚ªãƒ¼ãƒãƒ¼ãƒ¬ã‚¤ã‚’å»ƒæ­¢ã—ã¦ç›´æ¥ã‚¢ãƒ—ãƒªèµ·å‹•ã™ã‚‹æ–¹å¼ã¯å¤±æ•—ã™ã‚‹å¯èƒ½æ€§ãŒé«˜ã„ã€‚
> ç¾çŠ¶ã® `CheckinForegroundService.kt` + `OverlayController.kt`ï¼ˆFGS + ã‚ªãƒ¼ãƒãƒ¼ãƒ¬ã‚¤ï¼‰ã‚’ç¶­æŒã™ã‚‹ã€‚

**æ™‚é–“çµŒéå¾Œä»‹å…¥ãƒ¢ãƒ¼ãƒ‰ï¼ˆAndroidã®ã¿ï¼‰**
```
ã‚·ãƒ§ãƒ¼ãƒˆå‹•ç”»ã‚¢ãƒ—ãƒªä½¿ç”¨é–‹å§‹
    â†“
ãƒãƒƒã‚¯ã‚°ãƒ©ã‚¦ãƒ³ãƒ‰ã§ã‚¿ã‚¤ãƒãƒ¼é–‹å§‹ï¼ˆFGSå†…ï¼‰
    â†“
è¨­å®šæ™‚é–“ï¼ˆ5/10/15åˆ†ï¼‰çµŒé
    â†“
é«˜å„ªå…ˆåº¦é€šçŸ¥ã‚’è¡¨ç¤º
    â†“
ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒé€šçŸ¥ã‚¿ãƒƒãƒ— â†’ StopShortsã‚¢ãƒ—ãƒªèµ·å‹•ï¼ˆUrge Surfingç”»é¢ï¼‰
```

> âš ï¸ **iOSåˆ¶ç´„**: Family Controls Entitlementãªã—ã§ã¯ã‚¢ãƒ—ãƒªä½¿ç”¨çŠ¶æ³ã®ãƒãƒƒã‚¯ã‚°ãƒ©ã‚¦ãƒ³ãƒ‰æ¤œçŸ¥ãŒä¸å¯èƒ½ã€‚
> iOSã§ã¯æ™‚é–“çµŒéå¾Œä»‹å…¥ã¯å®Ÿè£…ã§ããªã„ã€‚

### 1.3 ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ åˆ¥å®Ÿè£…

| æ©Ÿèƒ½ | Android | iOS |
|------|---------|-----|
| å³æ™‚ä»‹å…¥ | âœ… FGS + ã‚ªãƒ¼ãƒãƒ¼ãƒ¬ã‚¤ | âŒ ä¸å¯ |
| æ™‚é–“çµŒéå¾Œä»‹å…¥ | âœ… FGS + é«˜å„ªå…ˆåº¦é€šçŸ¥ | âŒ ä¸å¯ |
| é€šçŸ¥ãƒªãƒã‚¤ãƒ³ãƒ€ãƒ¼ | âœ… | âœ…ï¼ˆæ‰‹å‹•è¨­å®šï¼‰ |
| ã‚·ãƒ§ãƒ¼ãƒˆã‚«ãƒƒãƒˆé€£æº | - | âš ï¸ å°†æ¥æ¤œè¨ |

#### Androidå®Ÿè£…æ–¹é‡

**å³æ™‚ä»‹å…¥ãƒ¢ãƒ¼ãƒ‰**
- ç¾çŠ¶ã® `OverlayController.kt` ã‚’æ‹¡å¼µ
- ã‚ªãƒ¼ãƒãƒ¼ãƒ¬ã‚¤å†…ã§Urge Surfingã®å…¨ãƒ•ã‚§ãƒ¼ã‚ºã‚’å®Ÿè£…ï¼ˆãƒã‚¤ãƒ†ã‚£ãƒ–UIï¼‰
- ã¾ãŸã¯ã€ã‚ªãƒ¼ãƒãƒ¼ãƒ¬ã‚¤ã¯ç°¡æ˜“è¡¨ç¤ºã®ã¾ã¾ã€ã€Œé–‹å§‹ã€ã‚¿ãƒƒãƒ—ã§ã‚¢ãƒ—ãƒªèµ·å‹•

**æ™‚é–“çµŒéå¾Œä»‹å…¥ãƒ¢ãƒ¼ãƒ‰**
- `CheckinForegroundService.kt` ã«ã‚¿ã‚¤ãƒãƒ¼æ©Ÿèƒ½ã‚’è¿½åŠ 
- ã‚¿ã‚¤ãƒãƒ¼å®Œäº†æ™‚ã«é«˜å„ªå…ˆåº¦é€šçŸ¥ï¼ˆ`IMPORTANCE_HIGH`ï¼‰ã‚’ç™ºè¡Œ
- é€šçŸ¥ã‚¿ãƒƒãƒ—ã§ãƒ‡ã‚£ãƒ¼ãƒ—ãƒªãƒ³ã‚¯ `stopshorts://urge-surfing` ã‚’èµ·å‹•

**ScreenTimeAndroidModule.kt å¤‰æ›´ç‚¹**
```kotlin
// æ–°è¦: ä»‹å…¥è¨­å®šã‚’å—ã‘å–ã‚‹ãƒ¡ã‚½ãƒƒãƒ‰
fun setInterventionSettings(timing: String, delayMinutes: Int)

// æ–°è¦: ã‚¿ã‚¤ãƒãƒ¼é–‹å§‹/åœæ­¢
fun startUsageTimer(packageName: String)
fun stopUsageTimer()
```

#### iOSå®Ÿè£…æ–¹é‡

Phase 1ï¼ˆMVPï¼‰:
- ä»‹å…¥æ©Ÿèƒ½ãªã—ï¼ˆæŠ€è¡“çš„ã«ä¸å¯èƒ½ï¼‰
- é€šçŸ¥ãƒªãƒã‚¤ãƒ³ãƒ€ãƒ¼ã®ã¿ï¼ˆãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒæ‰‹å‹•ã§æ™‚é–“è¨­å®šï¼‰
- ã€ŒTikTokã‚’ä½¿ã„ã™ãã¦ã„ã¾ã›ã‚“ã‹ï¼Ÿã€çš„ãªå®šæœŸé€šçŸ¥

Phase 2ï¼ˆå°†æ¥ï¼‰:
- ã‚·ãƒ§ãƒ¼ãƒˆã‚«ãƒƒãƒˆã‚¢ãƒ—ãƒªã¨ã®é€£æºã‚¬ã‚¤ãƒ‰æä¾›
- Screen Time APIç”³è«‹ï¼ˆæ‰¿èªã•ã‚Œã‚Œã°ï¼‰

### 1.4 è¨­å®šUI

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ âš™ï¸ ä»‹å…¥è¨­å®š                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                     â”‚
â”‚ ä»‹å…¥ã‚¿ã‚¤ãƒŸãƒ³ã‚°ï¼ˆAndroidï¼‰            â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚
â”‚ â”‚  å³æ™‚ä»‹å…¥   â”‚ æ™‚é–“çµŒéå¾Œ  â”‚       â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚
â”‚                                     â”‚
â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”‚
â”‚                                     â”‚
â”‚ è¨±å®¹æ™‚é–“ï¼ˆæ™‚é–“çµŒéå¾Œã®å ´åˆï¼‰         â”‚
â”‚   â—‹ 5åˆ†                             â”‚
â”‚   â—‹ 10åˆ†                            â”‚
â”‚   â—‹ 15åˆ†                            â”‚
â”‚                                     â”‚
â”‚ ğŸ’¡ è¨­å®šã—ãŸæ™‚é–“ãŒçµŒéã™ã‚‹ã¨          â”‚
â”‚    é€šçŸ¥ã§ãŠçŸ¥ã‚‰ã›ã—ã¾ã™              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

> ğŸ“± iOSã§ã¯ä»‹å…¥è¨­å®šã‚»ã‚¯ã‚·ãƒ§ãƒ³ã¯éè¡¨ç¤ºã€ã¾ãŸã¯ã€ŒAndroidã®ã¿å¯¾å¿œã€ã¨è¡¨ç¤º

### 1.5 å®Ÿè£…ã‚¿ã‚¹ã‚¯

| ã‚¿ã‚¹ã‚¯ | å„ªå…ˆåº¦ | å·¥æ•°ç›®å®‰ |
|--------|--------|---------|
| `useAppStore.ts` ã«ä»‹å…¥è¨­å®šã‚’è¿½åŠ  | é«˜ | å° |
| è¨­å®šç”»é¢UIä½œæˆï¼ˆPlatformåˆ†å²å«ã‚€ï¼‰ | é«˜ | ä¸­ |
| Android: ã‚ªãƒ¼ãƒãƒ¼ãƒ¬ã‚¤ã«Urge Surfingçµ±åˆ | é«˜ | å¤§ |
| Android: FGSã«ã‚¿ã‚¤ãƒãƒ¼æ©Ÿèƒ½è¿½åŠ  | é«˜ | å¤§ |
| Android: é«˜å„ªå…ˆåº¦é€šçŸ¥å®Ÿè£… | ä¸­ | ä¸­ |
| iOS: é€šçŸ¥ãƒªãƒã‚¤ãƒ³ãƒ€ãƒ¼è¨­å®šUI | ä½ | å° |

---

## 2. çµ±è¨ˆæŒ‡æ¨™ã®åˆ·æ–°

### 2.1 ç¾çŠ¶ã®å•é¡Œ

ç¾åœ¨ã®ã€Œã‚¹ãƒˆãƒªãƒ¼ã‚¯ã€æ–¹å¼ã®å•é¡Œ:
- é€£ç¶šæ—¥æ•°ãŒé€”åˆ‡ã‚Œã‚‹ã¨ãƒ¢ãƒãƒ™ãƒ¼ã‚·ãƒ§ãƒ³ä½ä¸‹
- ã€Œã‚¢ãƒ—ãƒªä½¿ç”¨æ—¥æ•°ã€ã‚’æ¸¬ã£ã¦ã‚‚æ„å‘³ãŒãªã„
- ä½•ãŒé€£ç¶šã—ã¦ã„ã‚‹ã®ã‹åˆ†ã‹ã‚Šã«ãã„

**ãƒ‡ãƒ¼ã‚¿åé›†ã®å•é¡Œ**:
- `recordUsageTime` ãƒ¡ã‚½ãƒƒãƒ‰ã¯å­˜åœ¨ã™ã‚‹ãŒã€å‘¼ã³å‡ºã—ç®‡æ‰€ãŒãªã„
- æœˆé–“ä½¿ç”¨é‡ãƒ‡ãƒ¼ã‚¿ãŒå¸¸ã«0ã«ãªã‚‹çŠ¶æ…‹

### 2.2 å‰æ: ä½¿ç”¨æ™‚é–“ãƒ‡ãƒ¼ã‚¿åé›†ã®å®Ÿè£…

çµ±è¨ˆæŒ‡æ¨™ã‚’æ©Ÿèƒ½ã•ã›ã‚‹ãŸã‚ã€ã¾ãšä½¿ç”¨æ™‚é–“ãƒ‡ãƒ¼ã‚¿ã®åé›†ã‚’å®Ÿè£…ã™ã‚‹å¿…è¦ãŒã‚ã‚‹ã€‚

#### ãƒ‡ãƒ¼ã‚¿åé›†ãƒ•ãƒ­ãƒ¼

```
[ã‚¢ãƒ—ãƒªèµ·å‹•æ™‚ / å®šæœŸãƒãƒƒã‚¯ã‚°ãƒ©ã‚¦ãƒ³ãƒ‰]
    â†“
ãƒã‚¤ãƒ†ã‚£ãƒ–ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã‹ã‚‰ä½¿ç”¨çµ±è¨ˆã‚’å–å¾—
  - Android: UsageStatsManager
  - iOS: Screen Time APIï¼ˆå°†æ¥ï¼‰
    â†“
æ—¥æ¬¡ä½¿ç”¨æ™‚é–“ã‚’ã‚¹ãƒˆã‚¢ã«è¨˜éŒ²
  useStatisticsStore.recordDailyUsage(date, minutes)
    â†“
çµ±è¨ˆæŒ‡æ¨™ã®è¨ˆç®—ã«ä½¿ç”¨
```

#### å®Ÿè£…ã‚¿ã‚¹ã‚¯ï¼ˆå‰æï¼‰

| ã‚¿ã‚¹ã‚¯ | èª¬æ˜ |
|--------|------|
| `syncDailyUsageFromNative()` | ãƒã‚¤ãƒ†ã‚£ãƒ–ã‹ã‚‰ä½¿ç”¨æ™‚é–“ã‚’å–å¾—ã—ã¦ã‚¹ãƒˆã‚¢ã«ä¿å­˜ |
| ã‚¢ãƒ—ãƒªèµ·å‹•æ™‚ã«è‡ªå‹•sync | `_layout.tsx` ã§åˆæœŸåŒ–æ™‚ã«å‘¼ã³å‡ºã— |
| æ—¥ä»˜å¤‰æ›´æ™‚ã®å‡¦ç† | å‰æ—¥åˆ†ã‚’ç¢ºå®šã€å½“æ—¥åˆ†ã‚’ãƒªã‚»ãƒƒãƒˆ |

### 2.3 æ–°ã—ã„æŒ‡æ¨™ä½“ç³»

#### 2.3.1 åŸºæº–å€¤ã‹ã‚‰ã®æ¸›å°‘ç‡

**è¨ˆç®—å¼**
```typescript
// åŸºæº–å€¤: ã‚ªãƒ³ãƒœãƒ¼ãƒ‡ã‚£ãƒ³ã‚°æ™‚ã«ä¿å­˜ï¼ˆæ–°è¦è¿½åŠ ãŒå¿…è¦ï¼‰
const baselineMonthlyMinutes = useAppStore.getState().baselineMonthlyMinutes;
const currentMonthlyMinutes = getCurrentMonthUsage();
const reductionRate = ((baselineMonthlyMinutes - currentMonthlyMinutes) / baselineMonthlyMinutes) * 100;
```

> âš ï¸ **å¿…è¦ãªå¤‰æ›´**: `useAppStore` ã« `baselineMonthlyMinutes` ã‚’è¿½åŠ ã—ã€
> ã‚ªãƒ³ãƒœãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ã® reality-check ç”»é¢ã§ä¿å­˜ã™ã‚‹ã€‚

**è¡¨ç¤ºä¾‹**
```
ğŸ“‰ åŸºæº–å€¤ã‹ã‚‰ 42% æ¸›å°‘
   æœˆ40æ™‚é–“ â†’ æœˆ23æ™‚é–“ï¼ˆ-17æ™‚é–“ï¼‰
```

**ç›®çš„**: ã‚ªãƒ³ãƒœãƒ¼ãƒ‡ã‚£ãƒ³ã‚°æ™‚ã®è‡ªåˆ†ã¨ã®æ¯”è¼ƒã§æˆé•·ã‚’å®Ÿæ„Ÿ

#### 2.3.2 æœˆé–“ãƒšãƒ¼ã‚¹æ¯”è¼ƒ

**è¨ˆç®—å¼**
```typescript
const lastMonthTotal = getMonthUsage(lastMonth); // å‰æœˆã®åˆè¨ˆ
const currentMonthUsage = getMonthUsage(currentMonth); // ä»Šæœˆã®ç¾åœ¨å€¤
const daysElapsed = new Date().getDate(); // ä»Šæœˆã®çµŒéæ—¥æ•°
const currentMonthPace = (currentMonthUsage / daysElapsed) * 30;
const difference = lastMonthTotal - currentMonthPace;
```

**è¡¨ç¤ºä¾‹**
```
ğŸ“Š ä»Šæœˆã®ãƒšãƒ¼ã‚¹
   å…ˆæœˆã‚ˆã‚Š 6æ™‚é–“ å°‘ãªã„è¦‹è¾¼ã¿ â†“

   å…ˆæœˆ: 30æ™‚é–“
   ä»Šæœˆ: 24æ™‚é–“ãƒšãƒ¼ã‚¹ï¼ˆ15æ—¥çµŒéï¼‰
```

**ç›®çš„**: æœˆæœ«ã‚’å¾…ãŸãšã«æ”¹å–„å‚¾å‘ã‚’ç¢ºèªã§ãã‚‹

#### 2.3.3 é”æˆæ—¥æ•°ï¼ˆç´¯ç©ãƒ»éé€£ç¶šï¼‰

**è¨ˆç®—å¼**
```typescript
const dailyGoalMinutes = settings.dailyGoalMinutes || 30;
const daysWithData = Object.entries(dailyStats)
  .filter(([date, _]) => isCurrentMonth(date) && hasUsageData(date));
const achievedDays = daysWithData.filter(([_, stats]) => stats.totalUsageMinutes <= dailyGoalMinutes).length;
const achievementRate = (achievedDays / daysWithData.length) * 100;
```

> âš ï¸ **æœªè¨ˆæ¸¬æ—¥ã®æ‰±ã„**: ä½¿ç”¨ãƒ‡ãƒ¼ã‚¿ãŒãªã„æ—¥ã¯åˆ†æ¯ã‹ã‚‰é™¤å¤–ã™ã‚‹ã€‚
> ç†ç”±: æœªè¨ˆæ¸¬ã‚’ã€Œ0åˆ†ã€ã¨ã¿ãªã™ã¨é”æˆç‡ãŒä¸å½“ã«é«˜ããªã‚‹ãŸã‚ã€‚

**è¡¨ç¤ºä¾‹**
```
ğŸ¯ ä»Šæœˆã®é”æˆçŠ¶æ³
   18 / 22 æ—¥ï¼ˆ82%ï¼‰

   [â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘]

   ğŸ¥ˆ ã‚·ãƒ«ãƒãƒ¼é”æˆä¸­ï¼
```

**ãƒãƒƒã‚¸ã‚·ã‚¹ãƒ†ãƒ **
| é”æˆç‡ | ãƒãƒƒã‚¸ |
|--------|--------|
| 90%+ | ğŸ¥‡ ã‚´ãƒ¼ãƒ«ãƒ‰ |
| 70-89% | ğŸ¥ˆ ã‚·ãƒ«ãƒãƒ¼ |
| 50-69% | ğŸ¥‰ ãƒ–ãƒ­ãƒ³ã‚º |

**ç›®çš„**: é€£ç¶šã‚’æ°—ã«ã›ãšç´¯ç©ã§è©•ä¾¡

#### 2.3.4 é€±é–“ãƒˆãƒ¬ãƒ³ãƒ‰

**è¨ˆç®—å¼**
```typescript
// é€±ã®å®šç¾©: æœˆæ›œå§‹ã¾ã‚Šï¼ˆISO 8601æº–æ‹ ï¼‰
const weeklyData = getLast4WeeksUsage(); // [week4, week3, week2, week1]
const trendDirection = weeklyData[3] < weeklyData[0] ? 'improving' : 'declining';
const overallChange = ((weeklyData[0] - weeklyData[3]) / weeklyData[0]) * 100;
```

> âš ï¸ **ã‚¿ã‚¤ãƒ ã‚¾ãƒ¼ãƒ³**: `dailyStats` ã®æ—¥ä»˜ã‚­ãƒ¼ã¯ç«¯æœ«ãƒ­ãƒ¼ã‚«ãƒ«æ™‚é–“åŸºæº–ã€‚
> é€±åŒºåˆ‡ã‚Šã¯ **æœˆæ›œå§‹ã¾ã‚Š** ã¨ã™ã‚‹ï¼ˆæ—¥æœ¬ã®æ…£ç¿’ã«åˆã‚ã›ã‚‹ï¼‰ã€‚

**è¡¨ç¤ºä¾‹**
```
ğŸ“ˆ é€±é–“ãƒˆãƒ¬ãƒ³ãƒ‰ï¼ˆéå»4é€±ï¼‰

  8h â”¤â– 
  7h â”¤ â– 
  6h â”¤   â– 
  5h â”¤     â–   â† ä»Šé€±
     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€
      4é€± 3é€± 2é€± 1é€±

  â†“ 4é€±é–“ã§ 37% æ¸›å°‘ä¸­
```

**ç›®çš„**: é•·æœŸçš„ãªæ”¹å–„å‚¾å‘ã‚’å¯è¦–åŒ–

#### 2.3.5 Habit Scoreï¼ˆã‚¹ãƒˆãƒªãƒ¼ã‚¯ä»£æ›¿ï¼‰

**è¨ˆç®—å¼**
```typescript
// 1æ—¥1å›ã®ã¿è©•ä¾¡ï¼ˆæ—¥ä»˜ã‚¬ãƒ¼ãƒ‰ä»˜ãï¼‰
function updateHabitScore() {
  const today = getDateKey();
  const state = get();

  // æ—¢ã«ä»Šæ—¥è©•ä¾¡æ¸ˆã¿ãªã‚‰ã‚¹ã‚­ãƒƒãƒ—
  if (state.habitScoreLastUpdatedDate === today) {
    return;
  }

  const yesterdayStats = state.dailyStats[getYesterdayKey()];
  const dailyGoalMinutes = state.settings?.dailyGoalMinutes || 30;
  const achieved = yesterdayStats && yesterdayStats.totalUsageMinutes <= dailyGoalMinutes;

  let newScore = state.habitScore;
  if (achieved) {
    newScore = Math.min(100, newScore + 10);
  } else {
    newScore = Math.max(0, newScore - 3);
  }

  set({
    habitScore: newScore,
    habitScoreLastUpdatedDate: today,
  });
}
```

> âš ï¸ **è©•ä¾¡ã‚¿ã‚¤ãƒŸãƒ³ã‚°**: ã‚¢ãƒ—ãƒªèµ·å‹•æ™‚ã«å‰æ—¥åˆ†ã‚’è©•ä¾¡ã€‚
> `habitScoreLastUpdatedDate` ã§é‡è¤‡è©•ä¾¡ã‚’é˜²æ­¢ã€‚

**è¡¨ç¤ºä¾‹**
```
ğŸ’ª ã‚ãªãŸã®ã‚¹ã‚³ã‚¢

   72 / 100
   [â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘]

   ãƒ¬ãƒ™ãƒ«: ä¸­ç´šã‚µãƒ¼ãƒ•ã‚¡ãƒ¼ ğŸ„
```

**ãƒ¬ãƒ™ãƒ«åˆ¤å®š**
| ã‚¹ã‚³ã‚¢ | ãƒ¬ãƒ™ãƒ« |
|--------|--------|
| 80-100 | ğŸ† ä¸Šç´šã‚µãƒ¼ãƒ•ã‚¡ãƒ¼ |
| 50-79 | ğŸ„ ä¸­ç´šã‚µãƒ¼ãƒ•ã‚¡ãƒ¼ |
| 0-49 | ğŸŒŠ åˆç´šã‚µãƒ¼ãƒ•ã‚¡ãƒ¼ |

**ç›®çš„**: 1æ—¥ã®å¤±æ•—ã§å…¨ãƒªã‚»ãƒƒãƒˆã•ã‚Œãªã„ç·©ã‚„ã‹ãªè©•ä¾¡

### 2.4 UIå¤‰æ›´

#### ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ï¼ˆindex.tsxï¼‰

ç¾åœ¨ã®StreakIndicatorã‚’ç½®ãæ›ãˆ:

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ğŸ“‰ ä»Šæœˆã®é€²æ—                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                     â”‚
â”‚  åŸºæº–å€¤ã‹ã‚‰ 42% æ¸›å°‘ â†“              â”‚
â”‚  [â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘]              â”‚
â”‚                                     â”‚
â”‚  ğŸ¯ 18/22æ—¥ é”æˆï¼ˆ82%ï¼‰ğŸ¥ˆ           â”‚
â”‚                                     â”‚
â”‚  â†’  è©³ç´°ã‚’è¦‹ã‚‹                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### çµ±è¨ˆç”»é¢ï¼ˆstatistics.tsxï¼‰

å…¨æŒ‡æ¨™ã‚’è¡¨ç¤º:

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ğŸ“Š ã‚ãªãŸã®çµ±è¨ˆ                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                     â”‚
â”‚ â”€â”€ ä»Šæœˆ â”€â”€                          â”‚
â”‚ åŸºæº–å€¤ã‹ã‚‰: -42%                    â”‚
â”‚ å…ˆæœˆæ¯”: -6æ™‚é–“                      â”‚
â”‚ é”æˆæ—¥æ•°: 18/22æ—¥ï¼ˆ82%ï¼‰ğŸ¥ˆ          â”‚
â”‚                                     â”‚
â”‚ â”€â”€ é€±é–“ãƒˆãƒ¬ãƒ³ãƒ‰ â”€â”€                  â”‚
â”‚ [é€±é–“ã‚°ãƒ©ãƒ•]                        â”‚
â”‚                                     â”‚
â”‚ â”€â”€ Habit Score â”€â”€                   â”‚
â”‚ 72/100 - ä¸­ç´šã‚µãƒ¼ãƒ•ã‚¡ãƒ¼ ğŸ„          â”‚
â”‚                                     â”‚
â”‚ â”€â”€ ä»‹å…¥åŠ¹æœ â”€â”€                      â”‚
â”‚ ä»Šæ—¥ã®ä»‹å…¥: 5å›                     â”‚
â”‚ è¡å‹•ãƒ–ãƒ­ãƒƒã‚¯ç‡: 80%                 â”‚
â”‚ å¹³å‡è¡å‹•è»½æ¸›: -53%                  â”‚
â”‚                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2.5 ãƒ‡ãƒ¼ã‚¿æ§‹é€ 

**useAppStore.ts ã«è¿½åŠ **

```typescript
interface AppState {
  // æ—¢å­˜ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰...

  // æ–°è¦è¿½åŠ : ã‚ªãƒ³ãƒœãƒ¼ãƒ‡ã‚£ãƒ³ã‚°æ™‚ã®åŸºæº–å€¤
  baselineMonthlyMinutes: number | null;

  // æ–°è¦è¿½åŠ : ä»‹å…¥è¨­å®š
  interventionSettings: InterventionSettings;
}

interface InterventionSettings {
  timing: 'immediate' | 'delayed';
  delayMinutes: 5 | 10 | 15;
}
```

**useStatisticsStore.ts ã«è¿½åŠ **

```typescript
interface StatisticsState {
  // æ—¢å­˜
  dailyStats: Record<string, DailyStatistics>;
  lifetime: LifetimeStatistics;
  interventionHistory: InterventionRecord[];

  // æ–°è¦è¿½åŠ 
  habitScore: number; // 0-100
  habitScoreLastUpdatedDate: string | null; // YYYY-MM-DDï¼ˆé‡è¤‡è©•ä¾¡é˜²æ­¢ï¼‰
}

interface DailyStatistics {
  // æ—¢å­˜ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰...

  // æ˜ç¤ºçš„ã«è¿½åŠ ï¼ˆå®Ÿéš›ã«ã¯ totalUsageMinutes ã§åˆ¤å®šå¯èƒ½ï¼‰
  goalAchieved?: boolean;
}
```

### 2.6 å®Ÿè£…ã‚¿ã‚¹ã‚¯

| ã‚¿ã‚¹ã‚¯ | å„ªå…ˆåº¦ | å·¥æ•°ç›®å®‰ | å‚™è€ƒ |
|--------|--------|---------|------|
| ãƒã‚¤ãƒ†ã‚£ãƒ–ã‹ã‚‰æ—¥æ¬¡ä½¿ç”¨æ™‚é–“ã‚’å–å¾—ãƒ»ä¿å­˜ã™ã‚‹ä»•çµ„ã¿ | é«˜ | å¤§ | **æœ€å„ªå…ˆ: ã“ã‚ŒãŒãªã„ã¨å…¨æŒ‡æ¨™ãŒå‹•ã‹ãªã„** |
| `useAppStore` ã« `baselineMonthlyMinutes` è¿½åŠ  | é«˜ | å° | reality-check.tsx ã§ä¿å­˜ |
| `useStatisticsStore` ã« `habitScore` é–¢é€£è¿½åŠ  | é«˜ | å° | |
| æ¸›å°‘ç‡è¨ˆç®—ãƒ­ã‚¸ãƒƒã‚¯å®Ÿè£… | é«˜ | å° | |
| æœˆé–“ãƒšãƒ¼ã‚¹æ¯”è¼ƒãƒ­ã‚¸ãƒƒã‚¯å®Ÿè£… | é«˜ | å° | |
| é”æˆæ—¥æ•°ãƒ»é”æˆç‡ãƒ­ã‚¸ãƒƒã‚¯å®Ÿè£… | é«˜ | å° | æœªè¨ˆæ¸¬æ—¥é™¤å¤–ãƒ­ã‚¸ãƒƒã‚¯å«ã‚€ |
| Habit Scoreè¨ˆç®—ãƒ­ã‚¸ãƒƒã‚¯å®Ÿè£… | ä¸­ | å° | æ—¥ä»˜ã‚¬ãƒ¼ãƒ‰å«ã‚€ |
| ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰UIæ›´æ–° | é«˜ | ä¸­ | StreakIndicatorç½®ãæ›ãˆ |
| çµ±è¨ˆç”»é¢UIæ›´æ–° | é«˜ | ä¸­ | |
| é€±é–“ãƒˆãƒ¬ãƒ³ãƒ‰ã‚°ãƒ©ãƒ•å®Ÿè£… | ä¸­ | ä¸­ | æœˆæ›œå§‹ã¾ã‚Š |

---

## 3. å®Ÿè£…é †åº

### Phase 1: ãƒ‡ãƒ¼ã‚¿åŸºç›¤æ•´å‚™ï¼ˆæœ€å„ªå…ˆï¼‰
1. ãƒã‚¤ãƒ†ã‚£ãƒ–ã‹ã‚‰æ—¥æ¬¡ä½¿ç”¨æ™‚é–“ã‚’å–å¾—ãƒ»ä¿å­˜ã™ã‚‹ä»•çµ„ã¿ã‚’å®Ÿè£…
2. `useAppStore` ã« `baselineMonthlyMinutes` ã‚’è¿½åŠ 
3. reality-check.tsx ã§ã‚ªãƒ³ãƒœãƒ¼ãƒ‡ã‚£ãƒ³ã‚°æ™‚ã«åŸºæº–å€¤ã‚’ä¿å­˜
4. `useStatisticsStore` ã« `habitScore`, `habitScoreLastUpdatedDate` ã‚’è¿½åŠ 

### Phase 2: çµ±è¨ˆæŒ‡æ¨™ãƒ­ã‚¸ãƒƒã‚¯å®Ÿè£…
1. æ¸›å°‘ç‡è¨ˆç®—
2. æœˆé–“ãƒšãƒ¼ã‚¹æ¯”è¼ƒè¨ˆç®—
3. é”æˆæ—¥æ•°ãƒ»é”æˆç‡è¨ˆç®—ï¼ˆæœªè¨ˆæ¸¬æ—¥é™¤å¤–ï¼‰
4. Habit Scoreè¨ˆç®—ï¼ˆæ—¥ä»˜ã‚¬ãƒ¼ãƒ‰ä»˜ãï¼‰
5. é€±é–“ãƒˆãƒ¬ãƒ³ãƒ‰è¨ˆç®—ï¼ˆæœˆæ›œå§‹ã¾ã‚Šï¼‰

### Phase 3: UIå®Ÿè£…
1. ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ã®é€²æ—ã‚«ãƒ¼ãƒ‰ï¼ˆStreakIndicatorç½®ãæ›ãˆï¼‰
2. çµ±è¨ˆç”»é¢ã®åˆ·æ–°
3. è¨­å®šç”»é¢ã«ä»‹å…¥ã‚¿ã‚¤ãƒŸãƒ³ã‚°è¨­å®šã‚’è¿½åŠ 

### Phase 4: Androidä»‹å…¥æ©Ÿèƒ½
1. ã‚ªãƒ¼ãƒãƒ¼ãƒ¬ã‚¤ã«Urge Surfingçµ±åˆï¼ˆã¾ãŸã¯ç°¡æ˜“ç‰ˆç¶­æŒï¼‰
2. FGSã«ã‚¿ã‚¤ãƒãƒ¼æ©Ÿèƒ½è¿½åŠ 
3. é«˜å„ªå…ˆåº¦é€šçŸ¥å®Ÿè£…

### Phase 5: iOSå¯¾å¿œï¼ˆå°†æ¥ï¼‰
1. é€šçŸ¥ãƒªãƒã‚¤ãƒ³ãƒ€ãƒ¼è¨­å®šUI
2. ã‚·ãƒ§ãƒ¼ãƒˆã‚«ãƒƒãƒˆé€£æºã‚¬ã‚¤ãƒ‰

---

## 4. é–¢é€£ãƒ•ã‚¡ã‚¤ãƒ«

| ãƒ•ã‚¡ã‚¤ãƒ« | å¤‰æ›´å†…å®¹ |
|---------|---------|
| `src/stores/useAppStore.ts` | `baselineMonthlyMinutes`, `interventionSettings` è¿½åŠ  |
| `src/stores/useStatisticsStore.ts` | `habitScore`, `habitScoreLastUpdatedDate`, æ–°æŒ‡æ¨™è¨ˆç®—ãƒ­ã‚¸ãƒƒã‚¯è¿½åŠ  |
| `src/services/badges.ts` | ã‚¹ãƒˆãƒªãƒ¼ã‚¯è¨ˆç®—ã‚’é”æˆæ—¥æ•°ãƒ™ãƒ¼ã‚¹ã«å¤‰æ›´ |
| `src/components/ui/StreakIndicator.tsx` | æ–°ã—ã„é€²æ—ã‚«ãƒ¼ãƒ‰ã«ç½®ãæ›ãˆï¼ˆã¾ãŸã¯æ–°ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆä½œæˆï¼‰ |
| `app/(onboarding)/reality-check.tsx` | `baselineMonthlyMinutes` ã®ä¿å­˜ã‚’è¿½åŠ  |
| `app/(main)/index.tsx` | ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰æ›´æ–° |
| `app/(main)/statistics.tsx` | çµ±è¨ˆç”»é¢åˆ·æ–° |
| `app/(main)/settings.tsx` | ä»‹å…¥è¨­å®šUIè¿½åŠ ï¼ˆæ–°è¦ã¾ãŸã¯æ—¢å­˜ã«è¿½åŠ ï¼‰ |
| `modules/screen-time-android/` | ã‚¿ã‚¤ãƒãƒ¼æ©Ÿèƒ½ã€é«˜å„ªå…ˆåº¦é€šçŸ¥å®Ÿè£… |
| `app/_layout.tsx` | ã‚¢ãƒ—ãƒªèµ·å‹•æ™‚ã®æ—¥æ¬¡ä½¿ç”¨æ™‚é–“syncå‡¦ç†è¿½åŠ  |

---

## 5. å‚è€ƒè³‡æ–™

### ãƒ¢ãƒãƒ™ãƒ¼ã‚·ãƒ§ãƒ³ç¶­æŒã®ãƒ™ã‚¹ãƒˆãƒ—ãƒ©ã‚¯ãƒ†ã‚£ã‚¹

- **Duolingo**: Streak Freezeã§é€£ç¶šé€”åˆ‡ã‚Œã®ã‚·ãƒ§ãƒƒã‚¯ã‚’ç·©å’Œ
- **YouTube Studio**: æ¯”è¼ƒãƒ™ãƒ¼ã‚¹ï¼ˆå…ˆé€±æ¯”ã€éå»28æ—¥å¹³å‡ï¼‰
- **Way of Life**: Habit Scoreæ–¹å¼ï¼ˆç·©ã‚„ã‹ãªå¢—æ¸›ï¼‰
- **Habitica**: ã‚²ãƒ¼ãƒŸãƒ•ã‚£ã‚±ãƒ¼ã‚·ãƒ§ãƒ³ï¼ˆRPGè¦ç´ ï¼‰

### å¿ƒç†å­¦çš„æ ¹æ‹ 

- **æå¤±å›é¿**: é€£ç¶šãŒé€”åˆ‡ã‚Œã‚‹ = å¤§ããªæå¤±æ„Ÿ â†’ é›¢è„±ãƒªã‚¹ã‚¯
- **é€²æ—ã®å¯è¦–åŒ–**: ç´¯ç©è¡¨ç¤ºã®æ–¹ãŒæŒç¶šçš„ãƒ¢ãƒãƒ™ãƒ¼ã‚·ãƒ§ãƒ³
- **æ¯”è¼ƒåŸºæº–**: éå»ã®è‡ªåˆ†ã¨ã®æ¯”è¼ƒãŒæœ€ã‚‚åŠ¹æœçš„
