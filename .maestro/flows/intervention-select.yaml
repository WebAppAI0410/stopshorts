# Intervention Settings E2E Test
# Tests accessing intervention settings and changing intervention type
#
# Prerequisites: None - uses demo mode skip if onboarding is shown

appId: com.nverse.stopshorts
---
- launchApp:
    clearState: true

# Wait for app to fully load
- waitForAnimationToEnd

# Handle iOS notification permission dialog
- runFlow:
    when:
      visible: "許可"
    commands:
      - tapOn: "許可"
      - waitForAnimationToEnd

# Handle Expo Dev Client dialogs
- runFlow:
    when:
      visible: "http://localhost:8081"
    commands:
      - tapOn: "http://localhost:8081"
      - waitForAnimationToEnd:
          timeout: 10000

- runFlow:
    when:
      visible: "Continue"
    commands:
      - tapOn: "Continue"
      - waitForAnimationToEnd

- runFlow:
    when:
      visible: "Close"
    commands:
      - tapOn: "Close"
      - waitForAnimationToEnd

# ============================================
# Skip onboarding using demo mode
# ============================================
- runFlow:
    when:
      visible: "始める"
    commands:
      - waitForAnimationToEnd
      - tapOn:
          text: ".*デモモードでスキップ.*"
      - waitForAnimationToEnd:
          timeout: 3000

# ============================================
# Navigate to Settings Tab
# ============================================
- waitForAnimationToEnd:
    timeout: 3000

- tapOn: "設定"
- waitForAnimationToEnd

# ============================================
# Access Intervention Settings
# ============================================
- scrollUntilVisible:
    element: "介入設定"
    direction: DOWN
    timeout: 15000
    speed: 40

- tapOn: "介入設定"
- waitForAnimationToEnd

# ============================================
# Verify Intervention Settings Screen
# ============================================
- assertVisible: "介入タイプ"

# Verify all intervention type options are visible
- assertVisible: "呼吸法"
- assertVisible: "フリクション"
- assertVisible: "ミラー"
- assertVisible: "AIと対話"

# ============================================
# Test: Select Friction Intervention
# ============================================
- tapOn: "フリクション"
- waitForAnimationToEnd

# Verify friction is now selected (description should be visible)
- assertVisible: "待機時間と意図確認"

# ============================================
# Test: Select Mirror Intervention
# ============================================
- scrollUntilVisible:
    element: "ミラー"
    direction: UP
    timeout: 5000

- tapOn: "ミラー"
- waitForAnimationToEnd

# Verify mirror description
- assertVisible: "自分の顔を見て"

# ============================================
# Test: Select Breathing Intervention
# ============================================
- tapOn: "呼吸法"
- waitForAnimationToEnd

# Verify breathing description
- assertVisible: "衝動を落ち着かせる"

# ============================================
# Test: Timing Settings
# ============================================
- scrollUntilVisible:
    element: "タイミング"
    direction: DOWN
    timeout: 10000

- assertVisible: "即時"

# ============================================
# Save Settings
# ============================================
- scrollUntilVisible:
    element: "保存"
    direction: DOWN
    timeout: 10000

- tapOn: "保存"
- waitForAnimationToEnd:
    timeout: 3000

# ============================================
# Verify return to Settings screen
# ============================================
- assertVisible: "設定"

# Take screenshot for verification
- takeScreenshot: "intervention_settings_complete"
