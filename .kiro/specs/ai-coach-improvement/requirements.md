# AI Coach Improvement - Requirements

## Overview

AIコーチ機能を改善し、「何をチャットで聞けばいいかわからない」問題を解決する。ユーザーが能動的にAIと対話を開始できるよう、複数の入り口と誘導を提供する。

---

## Current Problems

| 問題 | 詳細 |
|------|------|
| 入り口が不明瞭 | 「何でも聞いてください」だけでは何を聞けばいいかわからない |
| パーソナライズ不足 | ユーザーの状況に応じた提案がない |
| トレーニング連携なし | 9つのトレーニングトピックとAIが分断されている |
| 構造化された対話なし | 自由会話のみで、目的を持った対話ができない |

---

## Decisions

| 項目 | 決定 | 備考 |
|------|------|------|
| クイックアクション | 4モード常設 | Explore/Plan/Training/Reflect |
| 状況ベース提案 | 最大2個表示 | 優先度順、カテゴリ重複防止 |
| 会話スターター | 最大6個表示 | 動的選択、アプリ名は汎用表現 |
| デイリーチェックイン | 実装しない | 状況ベース提案で代替 |
| ガイド付き会話 | 2テンプレート | If-Then計画 + トリガー分析 |
| トレーニング推奨 | 会話中インライン | キーワードマッチング |
| ワークシート参照 | プロンプトに注入 | 最大3件 |

---

## Functional Requirements

### FR-1: クイックアクション常設化

| ID | 要件 | 優先度 |
|----|------|--------|
| FR-1.1 | AI画面に4つのクイックアクションボタンを常設表示 | P0 |
| FR-1.2 | 各ボタンタップでモード別セッション開始 | P0 |
| FR-1.3 | モード: Explore(探る), Plan(計画), Training(学習), Reflect(振り返り) | P0 |

### FR-2: 状況ベース提案カード

| ID | 要件 | 優先度 |
|----|------|--------|
| FR-2.1 | ユーザーの統計・進捗・時間帯に基づく動的提案表示 | P0 |
| FR-2.2 | 最大2個のカードを優先度順に表示 | P0 |
| FR-2.3 | カードタップで対応アクション実行（モード開始/画面遷移等） | P0 |
| FR-2.4 | 条件マッチなし時はカード非表示 | P0 |

### FR-3: 会話スターター

| ID | 要件 | 優先度 |
|----|------|--------|
| FR-3.1 | よくある悩み・質問を選択肢として表示 | P0 |
| FR-3.2 | タップで即座にユーザーメッセージとして送信 | P0 |
| FR-3.3 | 最大6個を2列グリッドで表示 | P0 |
| FR-3.4 | 統計・時間帯・トレーニング進捗に基づく動的選択 | P0 |
| FR-3.5 | 特定アプリ名は使わず汎用的な表現を使用 | P0 |

### FR-4: ガイド付き会話

| ID | 要件 | 優先度 |
|----|------|--------|
| FR-4.1 | If-Then計画作成テンプレート（4ステップ） | P0 |
| FR-4.2 | トリガー分析テンプレート（4ステップ） | P0 |
| FR-4.3 | 各ステップで選択肢 + 自由入力を提供 | P0 |
| FR-4.4 | 進捗インジケーター表示 | P0 |
| FR-4.5 | 完了時にデータを適切なストアに保存 | P0 |
| FR-4.6 | 中断時の確認ダイアログ | P1 |

### FR-5: トレーニング連携

| ID | 要件 | 優先度 |
|----|------|--------|
| FR-5.1 | 完了済みトピックの主要概念をプロンプトに注入 | P0 |
| FR-5.2 | ワークシート回答をプロンプトに注入（最大3件） | P0 |
| FR-5.3 | 会話内容に基づくトレーニング推奨（キーワードマッチング） | P0 |
| FR-5.4 | 推奨カードを会話中にインライン表示 | P0 |
| FR-5.5 | カードタップでトレーニング画面へ遷移 | P0 |

### FR-6: チャットUI最適化

| ID | 要件 | 優先度 |
|----|------|--------|
| FR-6.1 | 空状態UI（会話なし時）に提案・スターター表示 | P0 |
| FR-6.2 | 会話中はメッセージリストのみ表示 | P0 |
| FR-6.3 | ガイド付き会話時は専用UI表示 | P0 |

---

## Design Requirements

### DR-1: 空状態UI

- 上部: 状況ベース提案カード（0-2個）
- 中部: クイックアクション4ボタン
- 下部: 会話スターター（最大6個）

### DR-2: カラー

- 提案カード: `backgroundCard` + `accent` ボーダー
- クイックアクション: アイコン色分け
- スターター: `backgroundCard` + タップ時 `accent`

### DR-3: アニメーション

- 提案カード: FadeIn
- 会話開始時: 空状態 → メッセージリストへのトランジション

---

## Out of Scope

- プッシュ通知によるチェックイン促進
- 音声入力対応
- 日本語のみ対応
- 新規トレーニングトピックの追加

---

## Existing Assets

| 資料 | パス |
|------|------|
| AI画面 | `app/(main)/ai.tsx` |
| 介入AI（参考） | `src/components/interventions/AIIntervention.tsx` |
| AIストア | `src/stores/useAIStore.ts` |
| プロンプト構築 | `src/services/ai/promptBuilder.ts` |
| トレーニングデータ | `src/data/trainingTopics.ts` |
| 型定義 | `src/types/ai.ts` |
