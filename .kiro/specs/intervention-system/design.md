# ä»‹å…¥ã‚·ã‚¹ãƒ†ãƒ æ‹¡å¼µ - è¨­è¨ˆä»•æ§˜æ›¸

## ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£æ¦‚è¦

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    App Layer (expo-router)                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Onboarding Flow          â”‚  Main App (Bottom Tabs)         â”‚
â”‚  â”œâ”€ InterventionSelect    â”‚  â”œâ”€ Dashboard (çµ±è¨ˆãƒ»æ¦‚è¦)       â”‚
â”‚  â”œâ”€ InterventionPreview   â”‚  â”œâ”€ AI (ãƒãƒ£ãƒƒãƒˆ) â˜…å°‚ç”¨ã‚¿ãƒ–     â”‚
â”‚  â””â”€ InterventionExperienceâ”‚  â”œâ”€ Training (å¿ƒç†ãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°) â”‚
â”‚                           â”‚  â”œâ”€ Shield (ä»‹å…¥ç”»é¢)           â”‚
â”‚                           â”‚  â””â”€ Settings (è¨­å®š)             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                    Intervention Modules                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚ Urge     â”‚ â”‚ Friction â”‚ â”‚ Mirror   â”‚ â”‚ AI Chat          â”‚â”‚
â”‚  â”‚ Surfing  â”‚ â”‚ /Nudge   â”‚ â”‚ (Camera) â”‚ â”‚ (ä»‹å…¥ä¸­ã‚‚åˆ©ç”¨å¯) â”‚â”‚
â”‚  â”‚ (æ—¢å­˜)   â”‚ â”‚          â”‚ â”‚          â”‚ â”‚                  â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                    AI Engine (Qwen 3 0.6B)                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚ react-native-executorch                                 â”‚â”‚
â”‚  â”‚ â”œâ”€ Model Download Manager                               â”‚â”‚
â”‚  â”‚ â”œâ”€ Inference Engine                                     â”‚â”‚
â”‚  â”‚ â””â”€ Context Manager (å±¥æ­´ãƒ»ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ‡ãƒ¼ã‚¿)               â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                    State Management (Zustand)                â”‚
â”‚  useAppStore        â”‚  useStatisticsStore  â”‚  useAIStore    â”‚
â”‚  - interventionType â”‚  - frictionHistory   â”‚  - chatHistory â”‚
â”‚  - userGoal         â”‚  - intentionLog      â”‚  - personality â”‚
â”‚  - trainingProgress â”‚  - dailyOpenCount    â”‚  - llmStatus   â”‚
â”‚                     â”‚                      â”‚  - modelReady  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 1. ãƒ•ãƒªã‚¯ã‚·ãƒ§ãƒ³/ãƒŠãƒƒã‚¸ä»‹å…¥

### 1.1 ç´¯ç©å¾…æ©Ÿæ™‚é–“ã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ 

```typescript
// ãƒ•ã‚£ãƒœãƒŠãƒƒãƒé¢¨ã®æŒ‡æ•°çš„å¢—åŠ 
function calculateWaitTime(openCount: number): number {
  const baseSequence = [5, 8, 13, 21, 34, 55, 89];
  const index = Math.min(openCount, baseSequence.length - 1);
  return baseSequence[index];
}

// ãƒªã‚»ãƒƒãƒˆåˆ¤å®š
function shouldResetCount(lastOpenDate: string): boolean {
  const today = new Date().toDateString();
  const lastDate = new Date(lastOpenDate).toDateString();
  return today !== lastDate;
}
```

### 1.2 ç”»é¢ãƒ•ãƒ­ãƒ¼

```
[ã‚¢ãƒ—ãƒªèµ·å‹•æ¤œçŸ¥]
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  å¾…æ©Ÿã‚«ã‚¦ãƒ³ãƒˆãƒ€ã‚¦ãƒ³   â”‚
â”‚  ã€Œã‚ã¨ XX ç§’ã€      â”‚
â”‚  [ã‚­ãƒ£ãƒ³ã‚»ãƒ«]        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚ (å®Œäº†)
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  æ„å›³ç¢ºèª            â”‚
â”‚  ã€Œä½•ã‚’ã—ã«è¡Œãã¾ã™   â”‚
â”‚   ã‹ï¼Ÿã€             â”‚
â”‚  â—‹ DMã‚’ç¢ºèª         â”‚
â”‚  â—‹ ç‰¹å®šã®å‹•ç”»ã‚’è¦‹ã‚‹  â”‚
â”‚  â—‹ æš‡ã¤ã¶ã—         â”‚
â”‚  â—‹ ãªã‚“ã¨ãªã       â”‚
â”‚  â—‹ ãã®ä»– [å…¥åŠ›]    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  æœ€çµ‚ç¢ºèª            â”‚
â”‚  ã€Œæœ¬å½“ã«é–‹ãã¾ã™ã‹ï¼Ÿã€â”‚
â”‚  [é–‹ã] [ã‚„ã‚ã‚‹]     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 1.3 ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆè¨­è¨ˆ

```typescript
// src/components/interventions/FrictionIntervention.tsx

interface FrictionInterventionProps {
  blockedAppName: string;
  onProceed: () => void;
  onDismiss: () => void;
}

// States
type FrictionPhase = 'waiting' | 'intention' | 'confirm';

// æ„å›³ã®é¸æŠè‚¢
const INTENTION_OPTIONS = [
  { id: 'dm', label: 'DMã‚’ç¢ºèª', icon: 'chatbubble-outline' },
  { id: 'specific', label: 'ç‰¹å®šã®å‹•ç”»ã‚’è¦‹ã‚‹', icon: 'play-outline' },
  { id: 'bored', label: 'æš‡ã¤ã¶ã—', icon: 'time-outline' },
  { id: 'random', label: 'ãªã‚“ã¨ãªã', icon: 'help-outline' },
  { id: 'other', label: 'ãã®ä»–', icon: 'create-outline', hasInput: true },
] as const;
```

---

## 2. ãƒŸãƒ©ãƒ¼ä»‹å…¥

### 2.1 ç”»é¢æ§‹æˆ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚                       â”‚  â”‚
â”‚  â”‚   [ã‚«ãƒ¡ãƒ©ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼]    â”‚  â”‚
â”‚  â”‚                       â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚  â”‚
â”‚  â”‚  â”‚ ã‚ãªãŸã®ç›®æ¨™:    â”‚  â”‚  â”‚
â”‚  â”‚  â”‚ ã€Œç¡çœ ã‚’æ”¹å–„     â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  ã—ãŸã„ã€        â”‚  â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  â”‚
â”‚  â”‚                       â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                             â”‚
â”‚  ã“ã®é¡”ã§é–‹ãã¾ã™ã‹ï¼Ÿ        â”‚
â”‚                             â”‚
â”‚  [ã‚„ã‚ã‚‹]      [é–‹ã]       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2.2 ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆè¨­è¨ˆ

REQ-2.2ã®ã€Œ10-20ç§’ã®å†…çœæ™‚é–“ã€ã‚’åæ˜ ã—ã€ãƒŸãƒ©ãƒ¼è¡¨ç¤ºä¸­ã«ã‚«ã‚¦ãƒ³ãƒˆãƒ€ã‚¦ãƒ³ã‚’è¡¨ç¤ºã™ã‚‹ã€‚

```typescript
// src/components/interventions/MirrorIntervention.tsx

import { Camera, CameraView } from 'expo-camera';

interface MirrorInterventionProps {
  blockedAppName: string;
  userGoal: string;
  onProceed: () => void;
  onDismiss: () => void;
  // å†…çœæ™‚é–“ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ï¼ˆREQ-2.2: 10-20ç§’ã®å†…çœæ™‚é–“ï¼‰
  mirrorDuration?: number;     // ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ: 15ç§’
  showCountdown?: boolean;     // ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ: true
}

// å†…çœæ™‚é–“ã®ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤
const DEFAULT_MIRROR_DURATION = 15; // ç§’

// ã‚«ãƒ¡ãƒ©æ¨©é™ãŒå–ã‚Œãªã„å ´åˆã®ä»£æ›¿è¡¨ç¤º
// â†’ ç›®æ¨™ãƒ†ã‚­ã‚¹ãƒˆã®ã¿ã‚’å¤§ããè¡¨ç¤º
```

### 2.3 ã‚«ãƒ¡ãƒ©æ¨©é™å‡¦ç†

```typescript
async function requestCameraPermission(): Promise<boolean> {
  const { status } = await Camera.requestCameraPermissionsAsync();
  return status === 'granted';
}

// æ¨©é™ãŒãªã„å ´åˆã¯ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯UI
// ã€Œã‚«ãƒ¡ãƒ©ã‚’ä½¿ç”¨ã§ãã¾ã›ã‚“ã€‚ç›®æ¨™ã‚’ç¢ºèªã—ã¦ãã ã•ã„ã€‚ã€
```

---

## 3. ä»‹å…¥æ–¹æ³•é¸æŠã‚·ã‚¹ãƒ†ãƒ 

### 3.1 ãƒ‡ãƒ¼ã‚¿ãƒ¢ãƒ‡ãƒ«

#### 3.1.1 src/types/index.ts ã«è¿½åŠ ã™ã‚‹å‹å®šç¾©

```typescript
// src/types/index.ts ã«è¿½åŠ 

// ä»‹å…¥æ–¹æ³•ã®ç¨®åˆ¥
type InterventionType = 'breathing' | 'friction' | 'mirror' | 'ai';

// æ„å›³ãƒ­ã‚°ï¼ˆãƒ•ãƒªã‚¯ã‚·ãƒ§ãƒ³ä»‹å…¥ã§è¨˜éŒ²ï¼‰
interface IntentionLog {
  id: string;                 // ä¸€æ„ã®ID (uuid)
  intentionId: string;        // é¸æŠã—ãŸæ„å›³ã®ID ('dm', 'specific', 'bored', 'random', 'other')
  customText?: string;        // 'other' é¸æŠæ™‚ã®ã‚«ã‚¹ã‚¿ãƒ ãƒ†ã‚­ã‚¹ãƒˆ
  timestamp: string;          // è¨˜éŒ²æ—¥æ™‚ (ISO 8601)
  proceeded: boolean;         // ãã®å¾Œã‚¢ãƒ—ãƒªã‚’é–‹ã„ãŸã‹ã©ã†ã‹
}
```

#### 3.1.2 ä»‹å…¥è¨­å®šã®å‹

```typescript
// src/types/intervention.ts

type InterventionType = 'breathing' | 'friction' | 'mirror' | 'ai';

interface InterventionConfig {
  type: InterventionType;
  enabled: boolean;
  settings?: {
    // å‘¼å¸ç”¨
    breathingDuration?: number;
    // ãƒ•ãƒªã‚¯ã‚·ãƒ§ãƒ³ç”¨
    baseWaitTime?: number;
    // ãƒŸãƒ©ãƒ¼ç”¨
    mirrorDuration?: number;
    // AIç”¨ï¼ˆç‰¹åˆ¥ãªè¨­å®šã¯ä¸è¦ã€ãƒ¢ãƒ‡ãƒ«æº–å‚™çŠ¶æ…‹ã¯useAIStoreã§ç®¡ç†ï¼‰
  };
}

// ä»‹å…¥æ–¹æ³•ã®è¡¨ç¤ºæƒ…å ±
const INTERVENTION_OPTIONS = [
  { type: 'breathing', label: 'æ·±å‘¼å¸', icon: 'leaf-outline', description: 'å‘¼å¸ã«é›†ä¸­ã—ã¦è¡å‹•ã‚’ã‚„ã‚Šéã”ã™' },
  { type: 'friction', label: 'å¾…æ©Ÿ', icon: 'time-outline', description: 'å°‘ã—å¾…ã£ã¦ã€æœ¬å½“ã«é–‹ããŸã„ã‹è€ƒãˆã‚‹' },
  { type: 'mirror', label: 'ãƒŸãƒ©ãƒ¼', icon: 'camera-outline', description: 'è‡ªåˆ†ã®é¡”ã‚’è¦‹ã¦ã€ç›®æ¨™ã‚’æ€ã„å‡ºã™' },
  { type: 'ai', label: 'AIã¨è©±ã™', icon: 'chatbubble-outline', description: 'AIã¨è©±ã—ã¦ã€ãªãœé–‹ããŸã„ã‹æ¢ã‚‹' },
] as const;

// Zustand Storeæ‹¡å¼µ
interface AppStore {
  // æ—¢å­˜
  selectedInterventionType: InterventionType;
  setSelectedInterventionType: (type: InterventionType) => void;

  // ãƒ•ãƒªã‚¯ã‚·ãƒ§ãƒ³ç”¨
  dailyOpenCount: number;
  lastOpenDate: string;
  incrementOpenCount: () => void;
  resetOpenCountIfNeeded: () => void;
}
```

### 3.2 ã‚ªãƒ³ãƒœãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ãƒ•ãƒ­ãƒ¼å¤‰æ›´

```
ç¾åœ¨ã®ãƒ•ãƒ­ãƒ¼:
  welcome â†’ user-setup â†’ goal â†’ purpose â†’ app-selection
  â†’ reality-check â†’ if-then â†’ alternative â†’ summary â†’ shield-intro

æ–°ã—ã„ãƒ•ãƒ­ãƒ¼:
  welcome â†’ user-setup â†’ goal â†’ purpose â†’ app-selection
  â†’ reality-check â†’ [intervention-select] â†’ [intervention-experience]
  â†’ alternative â†’ summary â†’ [ai-preview] â†’ shield-intro

å¤‰æ›´ç‚¹:
  - if-then â†’ intervention-select (ç½®ãæ›ãˆ)
  - intervention-experience (æ–°è¦è¿½åŠ )
  - ai-preview (èª²é‡‘å‰ã«è¿½åŠ )
```

#### 3.2.1 completeOnboarding() ã®ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³æ›´æ–°

**æ›´æ–°ç®‡æ‰€**: `src/stores/useAppStore.ts` 416-424è¡Œ

æ—¢å­˜ã® `ifThenPlan` å¿…é ˆãƒã‚§ãƒƒã‚¯ã‚’ä»‹å…¥é¸æŠã«ç½®ãæ›ãˆã‚‹å¿…è¦ãŒã‚ã‚‹:

```typescript
// å¤‰æ›´å‰
completeOnboarding: () => {
  const state = get();
  // ifThenPlan å¿…é ˆãƒã‚§ãƒƒã‚¯
  if (!state.ifThenPlan) {
    console.warn('If-Then plan is required');
    return;
  }
  // ...
}

// å¤‰æ›´å¾Œ
completeOnboarding: () => {
  const state = get();
  // ä»‹å…¥æ–¹æ³•é¸æŠå¿…é ˆãƒã‚§ãƒƒã‚¯ï¼ˆif-then plan ãƒã‚§ãƒƒã‚¯ã‚’ç½®ãæ›ãˆï¼‰
  if (!state.selectedInterventionType) {
    console.warn('Intervention type selection is required');
    return;
  }
  // ...
}
```

**æ³¨æ„**: `ifThenPlan` ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã¯å°†æ¥çš„ã«å‰Šé™¤äºˆå®šã ãŒã€
ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³æœŸé–“ä¸­ã¯ä¸¡æ–¹ã®ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã‚’ä¿æŒã™ã‚‹ã“ã¨ã€‚

### 3.3 æ–°è¦ç”»é¢

```typescript
// app/(onboarding)/intervention-select.tsx
// ã€Œã©ã‚“ãªæ–¹æ³•ã§æ­¢ã‚ã‚‹ã®ãŒåŠ¹æœçš„ã§ã™ã‹ï¼Ÿã€

// app/(onboarding)/intervention-experience.tsx
// é¸ã‚“ã ä»‹å…¥æ–¹æ³•ã‚’ãƒ•ãƒ«ã§ä½“é¨“
// ã€Œä»–ã®æ–¹æ³•ã‚‚è©¦ã™ã€ãƒœã‚¿ãƒ³ã‚ã‚Š

// app/(onboarding)/ai-preview.tsx
// AIãƒãƒ£ãƒƒãƒˆã¨ãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°ã®ãƒ¢ãƒƒã‚¯ã‚¢ãƒƒãƒ—è¡¨ç¤º
```

---

## 4. AIãƒãƒ£ãƒƒãƒˆãƒœãƒƒãƒˆ

> **é‡è¦: é–‹ç™ºç’°å¢ƒã®åˆ¶ç´„**
>
> `react-native-executorch` ã¯ãƒã‚¤ãƒ†ã‚£ãƒ–ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã‚’ä½¿ç”¨ã™ã‚‹ãŸã‚ã€
> **Expo Go ã§ã¯å‹•ä½œã—ã¾ã›ã‚“**ã€‚é–‹ç™ºãƒ»ãƒ†ã‚¹ãƒˆã«ã¯ **Development Build (EAS Build)** ãŒå¿…é ˆã§ã™ã€‚
>
> ```bash
> # Development Build ã®ä½œæˆ
> eas build --profile development --platform android
> # ã¾ãŸã¯
> eas build --profile development --platform ios
> ```
>
> Expo Go ã‚’ä½¿ç”¨ã—ã¦ã„ã‚‹å ´åˆã€AIæ©Ÿèƒ½ã¯ã‚¹ã‚­ãƒƒãƒ—ã•ã‚Œã‚‹ã‹ã€
> ãƒ¢ãƒƒã‚¯ãƒ¢ãƒ¼ãƒ‰ã§å‹•ä½œã™ã‚‹ã‚ˆã†ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯å‡¦ç†ã‚’å®Ÿè£…ã™ã‚‹ã“ã¨ã€‚

### 4.1 ç”»é¢æ§‹æˆ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  â† AI ã‚¢ã‚·ã‚¹ã‚¿ãƒ³ãƒˆ              âš™ï¸     â”‚  â† ãƒ˜ãƒƒãƒ€ãƒ¼ï¼ˆè¨­å®šã§ãƒšãƒ«ã‚½ãƒŠå¤‰æ›´ï¼‰
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚ ğŸ¤– ä»Šæ—¥ã¯5å›é–‹ã“ã†ã¨ã—ãŸã­ã€‚   â”‚    â”‚  â† AIãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ï¼ˆçµ±è¨ˆè¨€åŠï¼‰
â”‚  â”‚    ä½•ã‹ã‚ã£ãŸï¼Ÿ                â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚              é€€å±ˆã ã£ãŸã‹ã‚‰... â”‚ ğŸ‘¤ â”‚  â† ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚ ğŸ¤– ãªã‚‹ã»ã©ã€‚é€€å±ˆãªæ™‚ã«é–‹ããŸã â”‚    â”‚
â”‚  â”‚    ãªã‚‹ã‚“ã ã­ã€‚ä»–ã«ä½•ã‹...     â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚ ğŸ’­ åŸå› ã‚’æ¢ã‚‹  â”‚ ğŸ“ ãƒ—ãƒ©ãƒ³ä½œæˆ  â”‚    â”‚  â† ã‚¯ã‚¤ãƒƒã‚¯ã‚¢ã‚¯ã‚·ãƒ§ãƒ³
â”‚  â”‚ ğŸ“š ãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°â”‚ ğŸŒ™ ä»Šæ—¥ã‚’æŒ¯ã‚Šè¿”ã‚‹â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” [é€ä¿¡]  â”‚  â† å…¥åŠ›ã‚¨ãƒªã‚¢
â”‚  â”‚ ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’å…¥åŠ›...        â”‚        â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 4.1.1 åˆå›ã‚¢ã‚¯ã‚»ã‚¹æ™‚ï¼ˆãƒ¢ãƒ‡ãƒ«æœªãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ï¼‰

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  â† AI ã‚¢ã‚·ã‚¹ã‚¿ãƒ³ãƒˆ                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                         â”‚
â”‚         ğŸ¤–                              â”‚
â”‚                                         â”‚
â”‚    AIã‚¢ã‚·ã‚¹ã‚¿ãƒ³ãƒˆã‚’æœ‰åŠ¹ã«ã—ã¾ã™ã‹ï¼Ÿ      â”‚
â”‚                                         â”‚
â”‚  ã‚ãªãŸå°‚ç”¨ã®AIã‚³ãƒ¼ãƒãŒ                 â”‚
â”‚  ã‚·ãƒ§ãƒ¼ãƒˆå‹•ç”»ã‚’æ¸›ã‚‰ã™æ‰‹åŠ©ã‘ã‚’ã—ã¾ã™ã€‚    â”‚
â”‚                                         â”‚
â”‚  ãƒ»çµ±è¨ˆã‚’è¦‹ã¦åŠ±ã¾ã—ã¦ãã‚Œã‚‹             â”‚
â”‚  ãƒ»ãªãœé–‹ããŸããªã‚‹ã‹ä¸€ç·’ã«æ¢ã‚‹         â”‚
â”‚  ãƒ»If-Thenãƒ—ãƒ©ãƒ³ã‚’ä½œæˆã‚µãƒãƒ¼ãƒˆ          â”‚
â”‚                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚ ãƒ¢ãƒ‡ãƒ«ã‚µã‚¤ã‚º: ç´„1.5GB           â”‚    â”‚
â”‚  â”‚ ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰æ™‚é–“: ç´„2-5åˆ†       â”‚    â”‚
â”‚  â”‚ â€» Wi-Fiæ¥ç¶šã‚’æ¨å¥¨               â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚         ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã™ã‚‹          â”‚  â”‚  â† ãƒ—ãƒ©ã‚¤ãƒãƒªãƒœã‚¿ãƒ³
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                         â”‚
â”‚           å¾Œã§è¨­å®šã™ã‚‹                  â”‚  â† ãƒ†ã‚­ã‚¹ãƒˆãƒªãƒ³ã‚¯
â”‚                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 4.1.2 ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ä¸­

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  â† AI ã‚¢ã‚·ã‚¹ã‚¿ãƒ³ãƒˆ                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                         â”‚
â”‚         ğŸ¤–                              â”‚
â”‚                                         â”‚
â”‚    AIãƒ¢ãƒ‡ãƒ«ã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ä¸­...          â”‚
â”‚                                         â”‚
â”‚  â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘  65%              â”‚
â”‚                                         â”‚
â”‚  æ®‹ã‚Šç´„ 1åˆ†30ç§’                         â”‚
â”‚                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚    ãƒãƒƒã‚¯ã‚°ãƒ©ã‚¦ãƒ³ãƒ‰ã§ç¶šã‘ã‚‹       â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 4.1.3 ä»‹å…¥ä¸­ã®AIãƒãƒ£ãƒƒãƒˆ

```
[Shieldç”»é¢: ä»‹å…¥æ–¹æ³•é¸æŠ]

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                         â”‚
â”‚  TikTokã‚’é–‹ã“ã†ã¨ã—ã¦ã„ã¾ã™              â”‚
â”‚                                         â”‚
â”‚  ã©ã®æ–¹æ³•ã§æ­¢ã‚ã¾ã™ã‹ï¼Ÿ                  â”‚
â”‚                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚  ğŸŒ¿ æ·±å‘¼å¸                      â”‚    â”‚
â”‚  â”‚  å‘¼å¸ã«é›†ä¸­ã—ã¦è¡å‹•ã‚’ã‚„ã‚Šéã”ã™ â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚  â³ å¾…æ©Ÿ                        â”‚    â”‚
â”‚  â”‚  å°‘ã—å¾…ã£ã¦ã€æœ¬å½“ã«é–‹ããŸã„ã‹è€ƒãˆã‚‹â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚  ğŸª ãƒŸãƒ©ãƒ¼                      â”‚    â”‚
â”‚  â”‚  è‡ªåˆ†ã®é¡”ã‚’è¦‹ã¦ã€ç›®æ¨™ã‚’æ€ã„å‡ºã™ â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚  ğŸ’¬ AIã¨è©±ã™                    â”‚    â”‚  â† AIä»‹å…¥ã‚ªãƒ—ã‚·ãƒ§ãƒ³
â”‚  â”‚  AIã¨è©±ã—ã¦ã€ãªãœé–‹ããŸã„ã‹æ¢ã‚‹ â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 4.1.4 ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£è©³ç´°

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    AI Chat Component                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Props:                                                      â”‚
â”‚  - mode: 'standalone' | 'intervention'                       â”‚
â”‚  - onComplete?: () => void  // ä»‹å…¥ãƒ¢ãƒ¼ãƒ‰ã§çµ‚äº†æ™‚            â”‚
â”‚  - initialPrompt?: string   // ä»‹å…¥ãƒ¢ãƒ¼ãƒ‰ã§åˆæœŸãƒ—ãƒ­ãƒ³ãƒ—ãƒˆ    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Context Builder                           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚ buildPrompt(userMessage, context) â†’ fullPrompt          â”‚â”‚
â”‚  â”‚                                                         â”‚â”‚
â”‚  â”‚ context = {                                             â”‚â”‚
â”‚  â”‚   stats: { todayOpens: 5, weeklyTrend: 'declining' },   â”‚â”‚
â”‚  â”‚   goals: { primary: 'ç¡çœ æ”¹å–„', purpose: '...' },       â”‚â”‚
â”‚  â”‚   persona: 'supportive',                                â”‚â”‚
â”‚  â”‚   recentHistory: [...last10Messages],                   â”‚â”‚
â”‚  â”‚   trainingProgress: ['habit-loop', 'urge-surfing'],     â”‚â”‚
â”‚  â”‚ }                                                       â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              Qwen 3 0.6B Engine (react-native-executorch)    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 4.2 æ¡ç”¨ãƒ¢ãƒ‡ãƒ«: Qwen 3 0.6B

**æ±ºå®šæ—¥**: 2026å¹´1æœˆ5æ—¥ï¼ˆæ›´æ–°ï¼‰

| é …ç›® | å€¤ |
|------|-----|
| ãƒ¢ãƒ‡ãƒ« | Qwen 3 0.6B |
| ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ | 0.6B |
| RAMè¦ä»¶ | 2GB |
| æ¨è«–é€Ÿåº¦ | é«˜é€Ÿï¼ˆExecuTorchæœ€é©åŒ–ï¼‰ |
| æ—¥æœ¬èªå¯¾å¿œ | âœ… è‰¯å¥½ï¼ˆå¤šè¨€èªå¯¾å¿œï¼‰ |
| ãƒ©ã‚¤ã‚»ãƒ³ã‚¹ | Apache 2.0 |
| å½¢å¼ | .pte (PyTorch ExecuTorch) |

**é¸å®šç†ç”±**:
- react-native-executorchå…¬å¼å¯¾å¿œï¼ˆsoftware-mansionæä¾›.pteï¼‰
- 2GB RAMã§å‹•ä½œå¯èƒ½ â†’ å¹…åºƒã„ãƒ‡ãƒã‚¤ã‚¹ã§å¯¾å¿œ
- æ—¥æœ¬èªã‚’å«ã‚€å¤šè¨€èªå¯¾å¿œ
- QWEN3_0_6Bå®šæ•°ã¨ã—ã¦æä¾›æ¸ˆã¿

**âš ï¸ Gemma 3n E2Bã‚’ä¸æ¡ç”¨ã®ç†ç”±**:
- `.task`/`.litertlm`å½¢å¼ï¼ˆGoogle LiteRTç”¨ï¼‰ã§react-native-executorchéå¯¾å¿œ

### 4.3 ãƒ¢ãƒ‡ãƒ«ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ãƒ•ãƒ­ãƒ¼

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  AIã‚¿ãƒ–åˆå›ã‚¢ã‚¯ã‚»ã‚¹æ™‚                                     â”‚
â”‚  (ãƒœãƒˆãƒ ãƒŠãƒ“ã®AIã‚¿ãƒ–ã‚’ã‚¿ãƒƒãƒ—)                             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  1. ãƒ‡ãƒã‚¤ã‚¹äº’æ›æ€§ãƒã‚§ãƒƒã‚¯                                â”‚
â”‚     â”œâ”€ RAM â‰¥ 2GB ?                                      â”‚
â”‚     â””â”€ ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ç©ºã â‰¥ 2GB ?                            â”‚
â”‚                                                         â”‚
â”‚  2a. äº’æ›æ€§ã‚ã‚Š                                          â”‚
â”‚      â†’ 4.1.1 ã®ç”»é¢ã‚’è¡¨ç¤ºï¼ˆãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ææ¡ˆï¼‰              â”‚
â”‚      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”‚
â”‚      â”‚  ã€ŒAIã‚¢ã‚·ã‚¹ã‚¿ãƒ³ãƒˆã‚’æœ‰åŠ¹ã«ã—ã¾ã™ã‹ï¼Ÿã€  â”‚            â”‚
â”‚      â”‚                                     â”‚            â”‚
â”‚      â”‚  ãƒ¢ãƒ‡ãƒ«ã‚µã‚¤ã‚º: ç´„1.5GB               â”‚            â”‚
â”‚      â”‚  ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰æ™‚é–“: ç´„2-5åˆ†ï¼ˆWi-Fiï¼‰   â”‚            â”‚
â”‚      â”‚                                     â”‚            â”‚
â”‚      â”‚  [å¾Œã§è¨­å®šã™ã‚‹]  [ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã™ã‚‹]   â”‚            â”‚
â”‚      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â”‚
â”‚                                                         â”‚
â”‚  2b. äº’æ›æ€§ãªã—                                          â”‚
â”‚      â†’ AIã‚¿ãƒ–ã‚’éè¡¨ç¤ºï¼ˆã¾ãŸã¯ç„¡åŠ¹åŒ–è¡¨ç¤ºï¼‰                  â”‚
â”‚      â†’ è¨­å®šç”»é¢ã§ã€ŒãŠä½¿ã„ã®ãƒ‡ãƒã‚¤ã‚¹ã§ã¯åˆ©ç”¨ä¸å¯ã€è¡¨ç¤º       â”‚
â”‚                                                         â”‚
â”‚  3. ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ä¸­                                        â”‚
â”‚      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”‚
â”‚      â”‚  ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ä¸­... 45%               â”‚            â”‚
â”‚      â”‚  â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘                â”‚            â”‚
â”‚      â”‚  [ãƒãƒƒã‚¯ã‚°ãƒ©ã‚¦ãƒ³ãƒ‰ã§ç¶šã‘ã‚‹]           â”‚            â”‚
â”‚      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â”‚
â”‚                                                         â”‚
â”‚  4. å®Œäº†                                                 â”‚
â”‚      â†’ ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ã«AIãƒãƒ£ãƒƒãƒˆãƒœã‚¿ãƒ³è¡¨ç¤º                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 4.4 React Nativeçµ±åˆ

```typescript
// src/services/ai/gemmaEngine.ts

import { useLLM } from 'react-native-executorch';

interface GemmaEngineConfig {
  modelPath: string;
  maxTokens: number;
  temperature: number;
}

interface GemmaEngine {
  isAvailable: boolean;
  isLoading: boolean;
  downloadProgress: number;
  generate: (prompt: string) => Promise<string>;
  downloadModel: () => Promise<void>;
}

// ãƒ‡ãƒã‚¤ã‚¹äº’æ›æ€§ãƒã‚§ãƒƒã‚¯
async function checkDeviceCompatibility(): Promise<{
  compatible: boolean;
  reason?: string;
}> {
  const deviceInfo = await getDeviceInfo();

  if (deviceInfo.totalMemory < 2 * 1024 * 1024 * 1024) {
    return { compatible: false, reason: 'insufficient_ram' };
  }

  const freeStorage = await getFreeStorage();
  if (freeStorage < 2 * 1024 * 1024 * 1024) {
    return { compatible: false, reason: 'insufficient_storage' };
  }

  return { compatible: true };
}
```

### 4.5 ã‚·ã‚¹ãƒ†ãƒ ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆè¨­è¨ˆ

```typescript
// src/services/ai/prompts.ts

interface PersonaConfig {
  id: string;
  name: string;
  description: string;
  systemPrompt: string;
}

const PERSONAS: PersonaConfig[] = [
  {
    id: 'supportive',
    name: 'åŠ±ã¾ã—å‹',
    description: 'ãƒã‚¸ãƒ†ã‚£ãƒ–ã«åŠ±ã¾ã—ã¦ãã‚Œã‚‹',
    systemPrompt: `ã‚ãªãŸã¯å„ªã—ãåŠ±ã¾ã—ã¦ãã‚Œã‚‹ã‚³ãƒ¼ãƒã§ã™ã€‚
ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®å°ã•ãªé€²æ­©ã‚‚èªã‚ã€å‰å‘ããªè¨€è‘‰ã‚’ã‹ã‘ã¦ãã ã•ã„ã€‚
æ‰¹åˆ¤ã‚„å¦å®šã¯ã›ãšã€å¸¸ã«å‘³æ–¹ã§ã‚ã‚‹ã“ã¨ã‚’ä¼ãˆã¦ãã ã•ã„ã€‚`,
  },
  {
    id: 'direct',
    name: 'ã‚¹ãƒˆãƒ¬ãƒ¼ãƒˆå‹',
    description: 'ç‡ç›´ã«ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯ã‚’ãã‚Œã‚‹',
    systemPrompt: `ã‚ãªãŸã¯ç‡ç›´ãªãƒˆãƒ¬ãƒ¼ãƒŠãƒ¼ã§ã™ã€‚
ãƒ¦ãƒ¼ã‚¶ãƒ¼ã«å¯¾ã—ã¦æ­£ç›´ã«ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯ã—ã¦ãã ã•ã„ã€‚
ç”˜ã‚„ã‹ã•ãšã€ã§ã‚‚æ”»æ’ƒçš„ã«ãªã‚‰ãšã€äº‹å®Ÿã«åŸºã¥ã„ã¦è©±ã—ã¦ãã ã•ã„ã€‚`,
  },
  // è¿½åŠ ã®ãƒšãƒ«ã‚½ãƒŠã¯èª¿æŸ»å¾Œã«æ±ºå®š
];
```

### 4.5.1 ãƒ¡ãƒ³ã‚¿ãƒ«ãƒ˜ãƒ«ã‚¹å¯¾å¿œï¼ˆç·©å’Œã‚±ã‚¢æ–¹é‡ï¼‰

```typescript
// src/services/ai/mentalHealthHandler.ts

// å±æ©Ÿçš„è¡¨ç¾ã®ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰æ¤œçŸ¥
const CRISIS_KEYWORDS = [
  'æ­»ã«ãŸã„', 'æ¶ˆãˆãŸã„', 'è‡ªæ®º', 'è‡ªå‚·',
  'ã‚‚ã†ç„¡ç†', 'ç”Ÿãã¦ã„ãŸããªã„', 'æ¥½ã«ãªã‚ŠãŸã„',
];

interface CrisisResponse {
  detected: boolean;
  severity: 'low' | 'medium' | 'high';
  suggestedResponse: string;
}

function detectCrisis(message: string): CrisisResponse {
  const hasKeyword = CRISIS_KEYWORDS.some(k => message.includes(k));
  if (!hasKeyword) return { detected: false, severity: 'low', suggestedResponse: '' };

  return {
    detected: true,
    severity: 'medium',
    suggestedResponse: CRISIS_RESPONSE_TEMPLATE,
  };
}

// ç·©å’Œã‚±ã‚¢å¿œç­”ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆ
const CRISIS_RESPONSE_TEMPLATE = `
ã¤ã‚‰ã„æ°—æŒã¡ã‚’è©±ã—ã¦ãã‚Œã¦ã‚ã‚ŠãŒã¨ã†ã€‚
ã‚ãªãŸã®æ°—æŒã¡ã‚’èã‹ã›ã¦ã‚‚ã‚‰ãˆã¦å¬‰ã—ã„ã§ã™ã€‚

ä»Šã€ã¨ã¦ã‚‚å¤§å¤‰ãªçŠ¶æ³ã«ã„ã‚‹ã‚“ã ã­ã€‚
ã‚‚ã—ã‚ˆã‘ã‚Œã°ã€å°‚é–€ã®ç›¸è«‡çª“å£ã«é€£çµ¡ã—ã¦ã¿ã‚‹ã“ã¨ã‚’è€ƒãˆã¦ã¿ã¦ãã ã•ã„ã€‚

ğŸ“ ã„ã®ã¡ã®é›»è©±: 0570-783-556
ğŸ“ ã‚ˆã‚Šãã„ãƒ›ãƒƒãƒˆãƒ©ã‚¤ãƒ³: 0120-279-338
ï¼ˆ24æ™‚é–“å¯¾å¿œï¼‰

ç§ã¯ã„ã¤ã§ã‚‚ã“ã“ã«ã„ã‚‹ã‚ˆã€‚
`;

// ã‚·ã‚¹ãƒ†ãƒ ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã«è¿½åŠ ã™ã‚‹ç·©å’Œã‚±ã‚¢ã‚¬ã‚¤ãƒ‰ãƒ©ã‚¤ãƒ³
const MENTAL_HEALTH_GUIDELINES = `
## ãƒ¡ãƒ³ã‚¿ãƒ«ãƒ˜ãƒ«ã‚¹å¯¾å¿œ
- å±æ©Ÿçš„ãªè¡¨ç¾ã‚’æ¤œçŸ¥ã—ãŸå ´åˆã€ã¾ãšå…±æ„Ÿã™ã‚‹
- ã€Œã¤ã‚‰ã„ã‚“ã ã­ã€ã€Œè©±ã—ã¦ãã‚Œã¦ã‚ã‚ŠãŒã¨ã†ã€ã‚’ä¼ãˆã‚‹
- å°‚é–€å®¶ã¸ã®ç›¸è«‡ã‚’å„ªã—ãææ¡ˆï¼ˆå¼·åˆ¶ã—ãªã„ï¼‰
- ç›¸è«‡çª“å£ã®æƒ…å ±ã‚’æä¾›ã™ã‚‹
- ã‚·ãƒ§ãƒ¼ãƒˆå‹•ç”»ä»¥å¤–ã®æ·±åˆ»ãªæ‚©ã¿ã«ã¯å¢ƒç•Œã‚’è¨­ã‘ã‚‹
- è¨ºæ–­ã‚„åŒ»ç™‚ã‚¢ãƒ‰ãƒã‚¤ã‚¹ã¯çµ¶å¯¾ã«ã—ãªã„
`;
```

### 4.6 ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆã‚¨ãƒ³ã‚¸ãƒ‹ã‚¢ãƒªãƒ³ã‚°

**è©³ç´°è¨­è¨ˆ**: [context-engineering.md](./context-engineering.md) ã‚’å‚ç…§

#### è¨­è¨ˆåŸå‰‡ï¼ˆManusã‹ã‚‰ã®æ•™è¨“ï¼‰

| åŸå‰‡ | å†…å®¹ |
|------|------|
| **Append-Only** | å±¥æ­´ã¯è¿½åŠ ã®ã¿ã€å‰Šé™¤ãƒ»ç·¨é›†ã—ãªã„ï¼ˆKVã‚­ãƒ£ãƒƒã‚·ãƒ¥åŠ¹ç‡ï¼‰ |
| **å®‰å®šãƒ—ãƒ¬ãƒ•ã‚£ãƒƒã‚¯ã‚¹** | ã‚·ã‚¹ãƒ†ãƒ ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã«å‹•çš„è¦ç´ ï¼ˆæ—¥æ™‚ç­‰ï¼‰ã‚’å«ã‚ãªã„ |
| **3å±¤ãƒ¡ãƒ¢ãƒª** | çŸ­æœŸï¼ˆã‚»ãƒƒã‚·ãƒ§ãƒ³ï¼‰â†’ ä¸­æœŸï¼ˆè¦ç´„ï¼‰â†’ é•·æœŸï¼ˆæ´å¯Ÿï¼‰ |
| **åœ§ç¸®æˆ¦ç•¥** | ãƒˆãƒ¼ã‚¯ãƒ³ä¸Šé™æ™‚ã¯å¤ã„ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’è¦ç´„ã«ç½®æ› |

#### ãƒ¡ãƒ¢ãƒªã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£æ¦‚è¦

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Context Window (~4K tokens)              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  System Prompt (å›ºå®š)                          ~500 tokens  â”‚
â”‚  User Context (ã‚»ãƒƒã‚·ãƒ§ãƒ³é–‹å§‹æ™‚)               ~300 tokens  â”‚
â”‚  Long-term Memory Summary (åœ§ç¸®æ¸ˆã¿)           ~200 tokens  â”‚
â”‚  Conversation History (ç›´è¿‘)                  ~2500 tokens  â”‚
â”‚  Current Input + Response Buffer               ~500 tokens  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### ã‚¢ãƒ—ãƒªã‚¢ãƒƒãƒ—ãƒ‡ãƒ¼ãƒˆäº’æ›æ€§

```typescript
// ã‚¹ã‚­ãƒ¼ãƒãƒãƒ¼ã‚¸ãƒ§ãƒ‹ãƒ³ã‚°
interface StoredData {
  schemaVersion: number;  // ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ç”¨
  longTermMemory: LongTermMemory;
  sessionSummaries: SessionSummary[];
}

// èµ·å‹•æ™‚ã«ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³å®Ÿè¡Œ
async function migrateIfNeeded(): Promise<void>;
```

### 4.7 ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆæ§‹ç¯‰

```typescript
// src/services/ai/context.ts

interface UserContext {
  stats: {
    todayOpenAttempts: number;
    todaySuccessfulBlocks: number;
    weeklyTrend: 'improving' | 'stable' | 'declining';
    longestStreak: number;
  };
  goals: {
    primaryGoal: string;
    purpose: string;
  };
  training: {
    completedTopics: string[];
    currentTopic?: string;
  };
  recentConversation: Message[];
}

function buildContextPrompt(context: UserContext): string {
  return `
## ãƒ¦ãƒ¼ã‚¶ãƒ¼æƒ…å ±
- ä»Šæ—¥ã®é–‹ã“ã†ã¨ã—ãŸå›æ•°: ${context.stats.todayOpenAttempts}å›
- ä»Šæ—¥ãƒ–ãƒ­ãƒƒã‚¯ã«æˆåŠŸã—ãŸå›æ•°: ${context.stats.todaySuccessfulBlocks}å›
- é€±é–“ãƒˆãƒ¬ãƒ³ãƒ‰: ${context.stats.weeklyTrend}
- ç›®æ¨™: ${context.goals.primaryGoal}
- å­¦ç¿’æ¸ˆã¿ãƒˆãƒ”ãƒƒã‚¯: ${context.training.completedTopics.join(', ')}
`;
}
```

---

## 5. å¿ƒç†ãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°

### 5.1 ã‚³ãƒ³ãƒ†ãƒ³ãƒ„æ§‹é€ 

```typescript
// src/types/training.ts

type ContentType = 'article' | 'quiz' | 'worksheet';

interface TrainingTopic {
  id: string;
  title: string;
  description: string;
  category: 'research' | 'emotional' | 'goal';
  estimatedMinutes: number;
  contents: TrainingContent[];
}

interface TrainingContent {
  id: string;
  type: ContentType;
  title: string;
  // è¨˜äº‹ã®å ´åˆ
  body?: string;
  // ã‚¯ã‚¤ã‚ºã®å ´åˆ
  questions?: QuizQuestion[];
  // ãƒ¯ãƒ¼ã‚¯ã‚·ãƒ¼ãƒˆã®å ´åˆ
  prompts?: WorksheetPrompt[];
}

interface QuizQuestion {
  question: string;
  options: string[];
  correctIndex: number;
  explanation: string;
}

interface WorksheetPrompt {
  prompt: string;
  placeholder: string;
  minLength?: number;
}
```

### 5.2 ãƒˆãƒ”ãƒƒã‚¯ä¸€è¦§ï¼ˆåˆæœŸï¼‰

```typescript
const INITIAL_TOPICS: TrainingTopic[] = [
  // ç ”ç©¶ãƒ™ãƒ¼ã‚¹ï¼ˆãƒ¡ã‚¤ãƒ³ï¼‰
  {
    id: 'habit-loop',
    title: 'ç¿’æ…£ãƒ«ãƒ¼ãƒ—ã‚’ç†è§£ã™ã‚‹',
    category: 'research',
    estimatedMinutes: 10,
    // ã‚­ãƒ¥ãƒ¼â†’ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³â†’å ±é…¬ã®ã‚µã‚¤ã‚¯ãƒ«
  },
  {
    id: 'implementation-intentions',
    title: 'If-Thenãƒ—ãƒ©ãƒ³ã®åŠ›',
    category: 'research',
    estimatedMinutes: 8,
    // å®Ÿè£…æ„å›³ã®ç ”ç©¶ã¨å®Ÿè·µ
  },
  {
    id: 'urge-surfing-deep',
    title: 'è¡å‹•ã‚µãƒ¼ãƒ•ã‚£ãƒ³ã‚°ã®ç§‘å­¦',
    category: 'research',
    estimatedMinutes: 12,
    // ãƒã‚¤ãƒ³ãƒ‰ãƒ•ãƒ«ãƒã‚¹ã¨è¡å‹•ã®é–¢ä¿‚
  },
  {
    id: 'prefrontal-cortex',
    title: 'è„³ã¨è‡ªåˆ¶å¿ƒ',
    category: 'research',
    estimatedMinutes: 10,
    // å‰é ­å‰çš®è³ªã¨é…å»¶å ±é…¬
  },
  {
    id: 'cognitive-reappraisal',
    title: 'è€ƒãˆæ–¹ã‚’å¤‰ãˆã‚‹æŠ€è¡“',
    category: 'research',
    estimatedMinutes: 10,
    // èªçŸ¥çš„å†è©•ä¾¡
  },

  // æƒ…ç·’ãƒ™ãƒ¼ã‚¹
  {
    id: 'boredom',
    title: 'é€€å±ˆã¨ã®ä»˜ãåˆã„æ–¹',
    category: 'emotional',
    estimatedMinutes: 8,
  },
  {
    id: 'loneliness',
    title: 'å­¤ç‹¬æ„Ÿã¨SNS',
    category: 'emotional',
    estimatedMinutes: 10,
  },

  // ç›®æ¨™ãƒ™ãƒ¼ã‚¹
  {
    id: 'sleep',
    title: 'ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ã‚¿ã‚¤ãƒ ã¨ç¡çœ ',
    category: 'goal',
    estimatedMinutes: 8,
  },
  {
    id: 'focus',
    title: 'é›†ä¸­åŠ›ã‚’å–ã‚Šæˆ»ã™',
    category: 'goal',
    estimatedMinutes: 10,
  },
];
```

### 5.3 ç”»é¢æ§‹æˆ

```
ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰
    â”‚
    â”œâ”€ ã€Œãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°ã€ã‚¿ãƒ–
    â”‚      â”‚
    â”‚      â–¼
    â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚  â”‚ ãƒˆãƒ”ãƒƒã‚¯é¸æŠç”»é¢        â”‚
    â”‚  â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
    â”‚  â”‚ â”‚ ğŸ“š ç ”ç©¶ãƒ™ãƒ¼ã‚¹       â”‚ â”‚
    â”‚  â”‚ â”‚ ãƒ»ç¿’æ…£ãƒ«ãƒ¼ãƒ— âœ“      â”‚ â”‚
    â”‚  â”‚ â”‚ ãƒ»If-Thenãƒ—ãƒ©ãƒ³     â”‚ â”‚
    â”‚  â”‚ â”‚ ãƒ»è¡å‹•ã‚µãƒ¼ãƒ•ã‚£ãƒ³ã‚°   â”‚ â”‚
    â”‚  â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
    â”‚  â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
    â”‚  â”‚ â”‚ ğŸ’­ æƒ…ç·’ãƒ™ãƒ¼ã‚¹       â”‚ â”‚
    â”‚  â”‚ â”‚ ãƒ»é€€å±ˆã¨ã®ä»˜ãåˆã„   â”‚ â”‚
    â”‚  â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
    â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â”‚          â”‚
    â”‚          â–¼
    â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚  â”‚ ãƒˆãƒ”ãƒƒã‚¯è©³ç´°            â”‚
    â”‚  â”‚ [è¨˜äº‹] [ã‚¯ã‚¤ã‚º] [æ¼”ç¿’]  â”‚
    â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 6. ãƒ‡ãƒ¼ã‚¿æ°¸ç¶šåŒ–

### 6.1 Zustand Store æ‹¡å¼µ

```typescript
// src/stores/useAppStore.ts æ‹¡å¼µ

interface InterventionState {
  // ä»‹å…¥è¨­å®š
  selectedInterventionType: InterventionType;

  // ãƒ•ãƒªã‚¯ã‚·ãƒ§ãƒ³ç”¨
  dailyOpenCount: number;
  lastOpenDate: string;
  intentionHistory: IntentionLog[];

  // AIè¨­å®š
  aiPersonaId: string;
  chatHistory: Message[];

  // ãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°é€²æ—
  completedTopics: string[];
  worksheetResponses: Record<string, string[]>;
}
```

### 6.2 çµ±è¨ˆãƒ‡ãƒ¼ã‚¿æ‹¡å¼µ

```typescript
// src/stores/useStatisticsStore.ts æ‹¡å¼µ

interface InterventionStats {
  // ä»‹å…¥åˆ¥ã®æˆåŠŸç‡
  interventionSuccessRate: Record<InterventionType, {
    attempts: number;
    blocked: number;
  }>;

  // æ„å›³åˆ¥ã®çµ±è¨ˆ
  intentionStats: Record<string, {
    count: number;
    proceededCount: number;
  }>;
}
```

---

## 7. å¤šè¨€èªå¯¾å¿œ (i18n)

### 7.1 i18nã‚­ãƒ¼æ§‹é€ 

```typescript
// src/i18n/locales/ja.json ã«è¿½åŠ ã™ã‚‹ã‚­ãƒ¼

{
  "intervention": {
    "friction": {
      "waiting": {
        "title": "å°‘ã—ãŠå¾…ã¡ãã ã•ã„",
        "countdown": "ã‚ã¨ {{seconds}} ç§’",
        "cancel": "ã‚­ãƒ£ãƒ³ã‚»ãƒ«"
      },
      "intention": {
        "title": "ä½•ã‚’ã—ã«è¡Œãã¾ã™ã‹ï¼Ÿ",
        "options": {
          "dm": "DMã‚’ç¢ºèª",
          "specific": "ç‰¹å®šã®å‹•ç”»ã‚’è¦‹ã‚‹",
          "bored": "æš‡ã¤ã¶ã—",
          "random": "ãªã‚“ã¨ãªã",
          "other": "ãã®ä»–"
        },
        "otherPlaceholder": "ç†ç”±ã‚’å…¥åŠ›..."
      },
      "confirm": {
        "title": "æœ¬å½“ã«é–‹ãã¾ã™ã‹ï¼Ÿ",
        "open": "é–‹ã",
        "dismiss": "ã‚„ã‚ã‚‹"
      }
    },
    "mirror": {
      "title": "ã“ã®é¡”ã§é–‹ãã¾ã™ã‹ï¼Ÿ",
      "goal": "ã‚ãªãŸã®ç›®æ¨™:",
      "open": "é–‹ã",
      "dismiss": "ã‚„ã‚ã‚‹",
      "cameraUnavailable": "ã‚«ãƒ¡ãƒ©ã‚’ä½¿ç”¨ã§ãã¾ã›ã‚“"
    },
    "selection": {
      "title": "ã©ã®æ–¹æ³•ã§æ­¢ã‚ã¾ã™ã‹ï¼Ÿ",
      "options": {
        "breathing": {
          "label": "æ·±å‘¼å¸",
          "description": "å‘¼å¸ã«é›†ä¸­ã—ã¦è¡å‹•ã‚’ã‚„ã‚Šéã”ã™"
        },
        "friction": {
          "label": "å¾…æ©Ÿ",
          "description": "å°‘ã—å¾…ã£ã¦ã€æœ¬å½“ã«é–‹ããŸã„ã‹è€ƒãˆã‚‹"
        },
        "mirror": {
          "label": "ãƒŸãƒ©ãƒ¼",
          "description": "è‡ªåˆ†ã®é¡”ã‚’è¦‹ã¦ã€ç›®æ¨™ã‚’æ€ã„å‡ºã™"
        },
        "ai": {
          "label": "AIã¨è©±ã™",
          "description": "AIã¨è©±ã—ã¦ã€ãªãœé–‹ããŸã„ã‹æ¢ã‚‹"
        }
      }
    },
    "ai": {
      "tab": "AI",
      "title": "AI ã‚¢ã‚·ã‚¹ã‚¿ãƒ³ãƒˆ",
      "placeholder": "ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’å…¥åŠ›...",
      "send": "é€ä¿¡",
      "quickActions": {
        "explore": "åŸå› ã‚’æ¢ã‚‹",
        "plan": "ãƒ—ãƒ©ãƒ³ä½œæˆ",
        "training": "ãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°",
        "reflect": "ä»Šæ—¥ã‚’æŒ¯ã‚Šè¿”ã‚‹"
      },
      "download": {
        "title": "AIã‚¢ã‚·ã‚¹ã‚¿ãƒ³ãƒˆã‚’æœ‰åŠ¹ã«ã—ã¾ã™ã‹ï¼Ÿ",
        "description": "ã‚ãªãŸå°‚ç”¨ã®AIã‚³ãƒ¼ãƒãŒã‚·ãƒ§ãƒ¼ãƒˆå‹•ç”»ã‚’æ¸›ã‚‰ã™æ‰‹åŠ©ã‘ã‚’ã—ã¾ã™ã€‚",
        "size": "ãƒ¢ãƒ‡ãƒ«ã‚µã‚¤ã‚º: ç´„1.5GB",
        "time": "ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰æ™‚é–“: ç´„2-5åˆ†",
        "wifiNote": "â€» Wi-Fiæ¥ç¶šã‚’æ¨å¥¨",
        "downloadButton": "ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã™ã‚‹",
        "later": "å¾Œã§è¨­å®šã™ã‚‹",
        "downloading": "ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ä¸­...",
        "progress": "{{percent}}%",
        "background": "ãƒãƒƒã‚¯ã‚°ãƒ©ã‚¦ãƒ³ãƒ‰ã§ç¶šã‘ã‚‹"
      },
      "unavailable": {
        "title": "AIãŒåˆ©ç”¨ã§ãã¾ã›ã‚“",
        "description": "ãŠä½¿ã„ã®ãƒ‡ãƒã‚¤ã‚¹ã§ã¯AIæ©Ÿèƒ½ã‚’ã”åˆ©ç”¨ã„ãŸã ã‘ã¾ã›ã‚“ã€‚"
      }
    }
  },
  "training": {
    "title": "ãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°",
    "categories": {
      "research": "ç ”ç©¶ãƒ™ãƒ¼ã‚¹",
      "emotional": "æƒ…ç·’ãƒ™ãƒ¼ã‚¹",
      "goal": "ç›®æ¨™ãƒ™ãƒ¼ã‚¹"
    },
    "completed": "å®Œäº†æ¸ˆã¿",
    "minutes": "{{minutes}}åˆ†",
    "quiz": {
      "correct": "æ­£è§£ï¼",
      "incorrect": "ä¸æ­£è§£",
      "next": "æ¬¡ã¸"
    }
  }
}
```

### 7.2 i18nä½¿ç”¨ä¾‹

```typescript
import { t } from '@/i18n';

// ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆå†…ã§ã®ä½¿ç”¨
<Text>{t('intervention.friction.waiting.title')}</Text>
<Text>{t('intervention.friction.waiting.countdown', { seconds: 15 })}</Text>
```

---

## 8. æŠ€è¡“çš„è€ƒæ…®äº‹é …

### 8.1 ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹

- ã‚«ãƒ¡ãƒ©ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ã¯ `expo-camera` ã® `CameraView` ã‚’ä½¿ç”¨
- ãƒ­ãƒ¼ã‚«ãƒ«LLMã¯ãƒãƒƒã‚¯ã‚°ãƒ©ã‚¦ãƒ³ãƒ‰ã‚¹ãƒ¬ãƒƒãƒ‰ã§å®Ÿè¡Œ
- ãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã¯é…å»¶èª­ã¿è¾¼ã¿

### 8.2 ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°

```typescript
// ã‚«ãƒ¡ãƒ©æ¨©é™ã‚¨ãƒ©ãƒ¼ â†’ ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯UI
// ãƒ­ãƒ¼ã‚«ãƒ«LLMéå¯¾å¿œ â†’ æ©Ÿèƒ½ã‚’ç„¡åŠ¹åŒ–
// ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã‚¨ãƒ©ãƒ¼ â†’ ã‚ªãƒ•ãƒ©ã‚¤ãƒ³ã§ã‚‚åŸºæœ¬æ©Ÿèƒ½ã¯å‹•ä½œ
```

### 8.3 ãƒ†ã‚¹ãƒˆæˆ¦ç•¥

#### 8.3.1 ãƒ¦ãƒ‹ãƒƒãƒˆãƒ†ã‚¹ãƒˆ
- ä»‹å…¥ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®ãƒ¦ãƒ‹ãƒƒãƒˆãƒ†ã‚¹ãƒˆ
- AIå¿œç­”ã®ãƒ¢ãƒƒã‚¯åŒ–
- `useSubscriptionAccess()` ãƒ•ãƒƒã‚¯ã®ãƒ†ã‚¹ãƒˆ

#### 8.3.2 E2Eãƒ†ã‚¹ãƒˆæˆ¦ç•¥

**âš ï¸ é‡è¦: E2Eãƒ†ã‚¹ãƒˆã®ãƒªã‚¹ã‚¯è©•ä¾¡**

èª¿æŸ»ã®çµæœã€E2Eãƒ†ã‚¹ãƒˆã«ã¯**ãƒ†ã‚¹ãƒˆãŒæ•°æ™‚é–“å®Œäº†ã—ãªã„**ãƒªã‚¹ã‚¯ãŒã‚ã‚‹ã“ã¨ãŒåˆ¤æ˜ã€‚
æœ¬ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®ç’°å¢ƒï¼ˆWindows + WSL2 + react-native-reanimatedï¼‰ã¯ç‰¹ã«ãƒªã‚¹ã‚¯ãŒé«˜ã„ã€‚

#### 8.3.3 ãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯æ¯”è¼ƒã¨æ—¢çŸ¥ã®å•é¡Œ

| é …ç›® | Maestro | Detox (æ—¢å­˜) |
|------|---------|--------------|
| å­¦ç¿’ã‚³ã‚¹ãƒˆ | ä½ (YAML) | ä¸­ (Jest) |
| WebViewå¯¾å¿œ | å„ªç§€ | èª²é¡Œã‚ã‚Š |
| Windowså¯¾å¿œ | âš ï¸ å•é¡Œå¤šæ•° | âš ï¸ WSL2çµŒç”± |
| ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ— | ä¸­ç¨‹åº¦ | è¤‡é›‘ |

**Maestroã®æ—¢çŸ¥ã®å•é¡Œï¼ˆ2024-2025å¹´ï¼‰**:

| å•é¡Œ | å½±éŸ¿ | å‚ç…§ |
|------|------|------|
| macOS Sequoia + Xcode 16 | ç„¡é™ãƒãƒ³ã‚°ï¼ˆidb-companionäº’æ›æ€§ï¼‰ | [#2906](https://github.com/mobile-dev-inc/maestro/issues/2906) |
| Windows + WSL2 | adbæ¥ç¶šãŒé »ç¹ã«åˆ‡æ–­ã€å†èµ·å‹•æ¯ã«å†è¨­å®šå¿…è¦ | [#1863](https://github.com/mobile-dev-inc/maestro/issues/1863) |
| react-native-reanimated | ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³å¾Œã®ã‚¿ãƒƒãƒ—ãŒãƒ©ãƒ³ãƒ€ãƒ å¤±æ•— | [#1703](https://github.com/mobile-dev-inc/maestro/issues/1703) |
| Expo New Architecture | iOSã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚¿ãƒ¼ãŒã‚¹ã‚¿ãƒƒã‚¯ãƒ»ã‚¯ãƒ©ãƒƒã‚·ãƒ¥ | [EAS #3153](https://github.com/expo/eas-cli/issues/3153) |
| Maestro Cloud | 7åˆ†/ãƒ•ãƒ­ãƒ¼ã®ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆåˆ¶é™ | å…¬å¼ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ |

**ãƒ†ã‚¹ãƒˆãŒçµ‚ã‚ã‚‰ãªã„ä¸»ãªåŸå› **:
1. **Windowsç’°å¢ƒ**: ADBæ¥ç¶šã®ä¸å®‰å®šã•ã€ãƒ•ã‚¡ã‚¤ã‚¢ã‚¦ã‚©ãƒ¼ãƒ«ãƒ–ãƒ­ãƒƒã‚¯
2. **ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³åŒæœŸ**: `waitForAnimationToEnd`ãŒç„¡é™å¾…æ©Ÿ
3. **ã‚¨ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚¿ãƒ¼èµ·å‹•**: èµ·å‹•å¾…æ©Ÿã®ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆä¸è¶³
4. **New Architecture**: Expo SDK 54ä»¥é™ã®äº’æ›æ€§å•é¡Œ

#### 8.3.4 æ¨å¥¨ã‚¢ãƒ—ãƒ­ãƒ¼ãƒï¼ˆãƒªã‚¹ã‚¯è»½æ¸›ï¼‰

**Option A: Maestro Cloudåˆ©ç”¨ï¼ˆæ¨å¥¨ï¼‰**
```
ãƒ¡ãƒªãƒƒãƒˆ: ã‚¨ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚¿ãƒ¼ç®¡ç†ä¸è¦ã€å®‰å®šã—ãŸç’°å¢ƒ
ãƒ‡ãƒ¡ãƒªãƒƒãƒˆ: æœ‰æ–™ã‚µãƒ¼ãƒ“ã‚¹ã€7åˆ†åˆ¶é™
é©ç”¨: CI/CDçµ±åˆã€ãƒªãƒªãƒ¼ã‚¹å‰ãƒã‚§ãƒƒã‚¯
```

**Option B: æ‰‹å‹•ãƒ†ã‚¹ãƒˆ + é™å®šçš„E2E**
```
ãƒ¡ãƒªãƒƒãƒˆ: ç’°å¢ƒå•é¡Œã‚’å›é¿ã€ç¢ºå®Ÿ
ãƒ‡ãƒ¡ãƒªãƒƒãƒˆ: å·¥æ•°ãŒã‹ã‹ã‚‹
é©ç”¨: é‡è¦ãƒ•ãƒ­ãƒ¼ï¼ˆã‚ªãƒ³ãƒœãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ã€èª²é‡‘ï¼‰ã®ã¿E2E
```

**Option C: ãƒ­ãƒ¼ã‚«ãƒ«Maestroï¼ˆmacOSé™å®šï¼‰**
```
ãƒ¡ãƒªãƒƒãƒˆ: é«˜é€Ÿãªãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯
ãƒ‡ãƒ¡ãƒªãƒƒãƒˆ: macOSç’°å¢ƒãŒå¿…è¦ã€iOSã®ã¿å®‰å®š
é©ç”¨: macOSã‚’ä½¿ç”¨ã§ãã‚‹å ´åˆ
```

#### 8.3.5 æœ¬ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã§ã®åˆ¤æ–­

**ç¾ç’°å¢ƒï¼ˆWindows + WSL2 + Androidï¼‰ã§ã®åˆ¶ç´„**:
- Maestroãƒ­ãƒ¼ã‚«ãƒ«å®Ÿè¡Œã¯**éæ¨å¥¨**ï¼ˆæ¥ç¶šå•é¡Œé »ç™ºï¼‰
- Detoxã¯**AVDæœªè¨­å®šãƒ»envæœªè¨­å®š**ã§å‹•ä½œä¸å¯

**ç¾å®Ÿçš„ãªé¸æŠè‚¢**:

| æ®µéš | æ–¹æ³• | ç†ç”± |
|------|------|------|
| é–‹ç™ºä¸­ | æ‰‹å‹•ãƒ†ã‚¹ãƒˆ | Windowsç’°å¢ƒã§ã®E2Eã¯ä¸å®‰å®š |
| PRæ™‚ | Maestro Cloud (ä»»æ„) | å®‰å®šç’°å¢ƒã§ã®ãƒ†ã‚¹ãƒˆ |
| ãƒªãƒªãƒ¼ã‚¹å‰ | Maestro Cloud | é‡è¦ãƒ•ãƒ­ãƒ¼ã®è‡ªå‹•æ¤œè¨¼ |

#### 8.3.6 å®Ÿè£…ã™ã‚‹å ´åˆã®æ³¨æ„ç‚¹

**react-native-reanimatedå¯¾ç­–**:
```yaml
# å„ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³å¾Œã«æ˜ç¤ºçš„å¾…æ©Ÿ
- tapOn: "Button"
- waitForAnimationToEnd
- extendedWaitUntil:
    visible: "NextScreen"
    timeout: 10000  # 10ç§’ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆ
```

**ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆè¨­å®š**:
```bash
# ã‚¨ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚¿ãƒ¼èµ·å‹•å¾…æ©Ÿã‚’å»¶é•·
export MAESTRO_DRIVER_STARTUP_TIMEOUT=120000  # 2åˆ†
```

**ãƒ†ã‚¹ãƒˆã®åˆ†å‰²**:
- å„ãƒ•ãƒ­ãƒ¼ã‚’ç‹¬ç«‹ã—ãŸãƒ•ã‚¡ã‚¤ãƒ«ã«åˆ†å‰²
- 7åˆ†ä»¥å†…ã«å®Œäº†ã™ã‚‹ã‚ˆã†è¨­è¨ˆ
- å¤±æ•—æ™‚ã®ãƒªãƒˆãƒ©ã‚¤ã‚’è¨­å®š

#### 8.3.7 ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹ä¾‹

**ã‚ªãƒ³ãƒœãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ãƒ•ãƒ­ãƒ¼ï¼ˆçŸ­ç¸®ç‰ˆï¼‰**:
```yaml
# .maestro/onboarding-smoke.yaml
appId: com.stopshorts
---
- launchApp:
    clearState: true
- waitForAnimationToEnd
- assertVisible: "ã‚·ãƒ§ãƒ¼ãƒˆå‹•ç”»ã‹ã‚‰æ™‚é–“ã‚’å–ã‚Šæˆ»ãã†"
- tapOn: "å§‹ã‚ã‚‹"
- waitForAnimationToEnd
- assertVisible: "ã‚ãªãŸã®ç›®æ¨™"
# å…¨ãƒ•ãƒ­ãƒ¼ã¯è¤‡æ•°ãƒ•ã‚¡ã‚¤ãƒ«ã«åˆ†å‰²
```

#### 8.3.8 CIçµ±åˆï¼ˆMaestro Cloudä½¿ç”¨æ™‚ï¼‰

```yaml
# .github/workflows/e2e.yml
name: E2E Tests
on:
  pull_request:
    branches: [main]

jobs:
  maestro-cloud:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - name: Build APK
        run: eas build --platform android --profile preview --local
      - name: Run Maestro Cloud
        uses: mobile-dev-inc/action-maestro-cloud@v1
        with:
          api-key: ${{ secrets.MAESTRO_CLOUD_API_KEY }}
          app-file: app-release.apk
          timeout: 30  # 30åˆ†ã§ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆ
```

#### 8.3.9 çµè«–

**E2Eãƒ†ã‚¹ãƒˆã®å„ªå…ˆåº¦ã‚’ä¸‹ã’ã‚‹ã“ã¨ã‚’æ¨å¥¨**ã€‚

ç†ç”±:
1. ç¾ç’°å¢ƒï¼ˆWindows + WSL2ï¼‰ã§ã¯ãƒ­ãƒ¼ã‚«ãƒ«E2EãŒä¸å®‰å®š
2. react-native-reanimatedã®å¤šç”¨ã§flaky testç™ºç”Ÿãƒªã‚¹ã‚¯é«˜
3. ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ãƒ»ãƒ‡ãƒãƒƒã‚°ã«æ•°æ—¥ã€œæ•°é€±é–“ã‹ã‹ã‚‹å¯èƒ½æ€§

ä»£æ›¿æ¡ˆ:
- **ãƒ¦ãƒ‹ãƒƒãƒˆãƒ†ã‚¹ãƒˆ**: ä»‹å…¥ãƒ­ã‚¸ãƒƒã‚¯ã€ã‚¢ã‚¯ã‚»ã‚¹åˆ¶å¾¡ãƒ•ãƒƒã‚¯ã®ãƒ†ã‚¹ãƒˆ
- **ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆãƒ†ã‚¹ãƒˆ**: Storybook + ãƒ†ã‚¹ãƒˆ
- **æ‰‹å‹•ãƒ†ã‚¹ãƒˆ**: é‡è¦ãƒ•ãƒ­ãƒ¼ã®ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆä½œæˆ

---

## 9. ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ å›ºæœ‰ã®è€ƒæ…®äº‹é …

### 9.1 Phase 1-4 (React Native ã®ã¿)

- ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ å·®ç•°ãªã—
- Androidå„ªå…ˆã§å®Ÿè£…ã€iOSæ¤œè¨¼å¾Œç¶š

### 9.2 Phase 5 (AI) ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ å¯¾å¿œ

```typescript
// src/services/ai/platformUtils.ts

import { Platform } from 'react-native';
import RNFS from 'react-native-fs';

// ãƒ¢ãƒ‡ãƒ«ä¿å­˜ãƒ‘ã‚¹
export function getModelDirectory(): string {
  return Platform.select({
    android: `${RNFS.DocumentDirectoryPath}/models`,
    ios: `${RNFS.DocumentDirectoryPath}/models`,
  })!;
}

// ãƒ‡ãƒã‚¤ã‚¹æƒ…å ±å–å¾—ï¼ˆRAMï¼‰
export async function getDeviceMemoryGB(): Promise<number> {
  if (Platform.OS === 'android') {
    // Android: ActivityManagerçµŒç”±
    const { totalMem } = await getMemoryInfo();
    return totalMem / (1024 * 1024 * 1024);
  } else {
    // iOS: ProcessInfoçµŒç”±
    const { physicalMemory } = await getDeviceInfo();
    return physicalMemory / (1024 * 1024 * 1024);
  }
}

// ç©ºãã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸å–å¾—
export async function getFreeStorageGB(): Promise<number> {
  const info = await RNFS.getFSInfo();
  return info.freeSpace / (1024 * 1024 * 1024);
}
```

### 9.3 å®Ÿè£…é †åº

1. **Androidå®Ÿè£…** â†’ å®Ÿæ©Ÿãƒ†ã‚¹ãƒˆ â†’ ã‚³ãƒ¼ãƒ‰ç¢ºå®š
2. **iOSå¯¾å¿œ** â†’ ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ å·®ç•°å¯¾å¿œ â†’ å®Ÿæ©Ÿãƒ†ã‚¹ãƒˆ
3. **çµ±åˆãƒ†ã‚¹ãƒˆ** â†’ ä¸¡ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ ã§å‹•ä½œç¢ºèª

---

## 10. èª²é‡‘çŠ¶æ…‹ã«ã‚ˆã‚‹ã‚¢ã‚¯ã‚»ã‚¹åˆ¶å¾¡

### 10.1 æ—¢å­˜ã®èª²é‡‘çŠ¶æ…‹ç®¡ç†ï¼ˆå‚ç…§ï¼‰

**æ—¢å­˜å®Ÿè£…**: `src/stores/useAppStore.ts`, `src/types/index.ts`

```typescript
// æ—¢å­˜ã®å‹å®šç¾©ï¼ˆsrc/types/index.tsï¼‰
type SubscriptionPlan = 'free' | 'trial' | 'monthly' | 'quarterly' | 'annual';
type SubscriptionStatus = 'active' | 'expired' | 'cancelled';

// æ—¢å­˜ã®ã‚¹ãƒˆã‚¢çŠ¶æ…‹ï¼ˆuseAppStoreï¼‰
subscriptionPlan: SubscriptionPlan;      // ç¾åœ¨ã®ãƒ—ãƒ©ãƒ³
subscriptionStatus: SubscriptionStatus;  // ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹
subscriptionExpiry: string | null;       // æœ‰åŠ¹æœŸé™ï¼ˆISOæ—¥ä»˜ï¼‰
trialStartDate: string | null;           // ãƒˆãƒ©ã‚¤ã‚¢ãƒ«é–‹å§‹æ—¥
```

**ãƒ—ãƒ©ãƒ³æ§‹æˆï¼ˆæ—¢å­˜ï¼‰**:
| ãƒ—ãƒ©ãƒ³ | æœŸé–“ | å‰²å¼• |
|--------|------|------|
| trial | 3æ—¥é–“ | - |
| monthly | 30æ—¥ | - |
| quarterly | 90æ—¥ | 20% |
| annual | 365æ—¥ | 50% |

### 10.2 ã‚¢ã‚¯ã‚»ã‚¹åˆ¤å®šãƒ­ã‚¸ãƒƒã‚¯

**é‡è¦**: `isExpired` ã®åˆ¤å®šã¯ `subscriptionStatus === 'expired'` ã‚’çœŸã®ã‚½ãƒ¼ã‚¹ã¨ã—ã¦ä½¿ç”¨ã™ã‚‹ã€‚
æ—¥ä»˜ãƒ™ãƒ¼ã‚¹ã®è¨ˆç®—ã¯å†—é•·ã§ã‚ã‚Šã€ã‚¹ãƒˆã‚¢ã®çŠ¶æ…‹ã¨ä¸æ•´åˆã‚’èµ·ã“ã™å¯èƒ½æ€§ãŒã‚ã‚‹ã€‚
ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ï¼ˆApp Store/Play Storeï¼‰ã®Webhookã¾ãŸã¯ã‚¢ãƒ—ãƒªèµ·å‹•æ™‚ã®æ¤œè¨¼ã§
`subscriptionStatus` ã‚’æ›´æ–°ã—ã€ãã®å€¤ã‚’ä¿¡é ¼ã™ã‚‹è¨­è¨ˆã¨ã™ã‚‹ã€‚

```typescript
// src/hooks/useSubscriptionAccess.ts

import { useAppStore } from '@/stores/useAppStore';

export function useSubscriptionAccess() {
  const {
    subscriptionPlan,
    subscriptionStatus,
    subscriptionExpiry,
  } = useAppStore();

  // ã‚¢ã‚¯ãƒ†ã‚£ãƒ–ãªèª²é‡‘çŠ¶æ…‹ã‹ã©ã†ã‹
  const isActive = subscriptionStatus === 'active';

  // ãƒˆãƒ©ã‚¤ã‚¢ãƒ«ä¸­ã‹ã©ã†ã‹
  const isTrialing = subscriptionPlan === 'trial' && isActive;

  // æœ‰æ–™ãƒ—ãƒ©ãƒ³ä¸­ã‹ã©ã†ã‹
  const isPaid = ['monthly', 'quarterly', 'annual'].includes(subscriptionPlan) && isActive;

  // å…¨æ©Ÿèƒ½ã‚¢ã‚¯ã‚»ã‚¹å¯èƒ½ã‹ã©ã†ã‹ï¼ˆãƒˆãƒ©ã‚¤ã‚¢ãƒ« or æœ‰æ–™ï¼‰
  const hasFullAccess = isTrialing || isPaid;

  // æœŸé™åˆ‡ã‚Œãƒã‚§ãƒƒã‚¯
  // â˜… subscriptionStatus === 'expired' ã‚’çœŸã®ã‚½ãƒ¼ã‚¹ã¨ã—ã¦ä½¿ç”¨
  // æ—¥ä»˜ãƒ™ãƒ¼ã‚¹ã®è¨ˆç®—ã¯å‚è€ƒå€¤ã¨ã—ã¦ã®ã¿ä½¿ç”¨ï¼ˆãƒ‡ãƒãƒƒã‚°/è¡¨ç¤ºç”¨ï¼‰
  const isExpired = subscriptionStatus === 'expired';

  // å‚è€ƒ: æ—¥ä»˜ãƒ™ãƒ¼ã‚¹ã®æœŸé™åˆ‡ã‚Œç¢ºèªï¼ˆè¡¨ç¤ºç”¨é€”ã®ã¿ï¼‰
  const isExpiryDatePassed = subscriptionExpiry
    ? new Date(subscriptionExpiry) < new Date()
    : false;

  return {
    hasFullAccess,
    isTrialing,
    isPaid,
    isExpired,
    isExpiryDatePassed, // è¡¨ç¤ºç”¨é€”ã®ã¿
    subscriptionPlan,
  };
}
```

### 10.3 æ©Ÿèƒ½ã‚¢ã‚¯ã‚»ã‚¹åˆ¶å¾¡ï¼ˆä»‹å…¥ã‚·ã‚¹ãƒ†ãƒ ï¼‰

**åŸå‰‡**: å…¨ã¦ã®æ–°è¦ä»‹å…¥æ©Ÿèƒ½ã¯ãƒˆãƒ©ã‚¤ã‚¢ãƒ«ä¸­ or æœ‰æ–™ã§ã®ã¿åˆ©ç”¨å¯èƒ½

```typescript
// src/components/interventions/InterventionGate.tsx

import { useSubscriptionAccess } from '@/hooks/useSubscriptionAccess';
import { useRouter } from 'expo-router';

interface InterventionGateProps {
  children: React.ReactNode;
}

export function InterventionGate({ children }: InterventionGateProps) {
  const { hasFullAccess, isExpired } = useSubscriptionAccess();
  const router = useRouter();

  // æœŸé™åˆ‡ã‚Œã®å ´åˆã¯èª²é‡‘ç”»é¢ã¸èª˜å°
  if (isExpired || !hasFullAccess) {
    return (
      <ExpiredSubscriptionScreen
        onSubscribe={() => router.push('/paywall')}
      />
    );
  }

  return <>{children}</>;
}
```

### 10.4 æœŸé™åˆ‡ã‚Œæ™‚ã®UI

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                         â”‚
â”‚  ãƒˆãƒ©ã‚¤ã‚¢ãƒ«æœŸé–“ãŒçµ‚äº†ã—ã¾ã—ãŸ            â”‚
â”‚                                         â”‚
â”‚  å¼•ãç¶šãStopShortsã‚’ã”åˆ©ç”¨ã„ãŸã ã      â”‚
â”‚  ã«ã¯ãƒ—ãƒ©ãƒ³ã‚’é¸æŠã—ã¦ãã ã•ã„ã€‚          â”‚
â”‚                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚       ãƒ—ãƒ©ãƒ³ã‚’é¸æŠã™ã‚‹             â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                         â”‚
â”‚          è³¼å…¥ã‚’å¾©å…ƒ                      â”‚
â”‚                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 10.5 ä»‹å…¥æ©Ÿèƒ½ã¨ã‚¢ã‚¯ã‚»ã‚¹æ¨©

| æ©Ÿèƒ½ | èª²é‡‘çŠ¶æ…‹ãªã— | ãƒˆãƒ©ã‚¤ã‚¢ãƒ« | æœ‰æ–™ |
|------|-------------|-----------|------|
| æ·±å‘¼å¸ï¼ˆè¡å‹•ã‚µãƒ¼ãƒ•ã‚£ãƒ³ã‚°ï¼‰ | âŒ | âœ… | âœ… |
| ãƒ•ãƒªã‚¯ã‚·ãƒ§ãƒ³ä»‹å…¥ | âŒ | âœ… | âœ… |
| ãƒŸãƒ©ãƒ¼ä»‹å…¥ | âŒ | âœ… | âœ… |
| AIãƒãƒ£ãƒƒãƒˆ | âŒ | âœ… | âœ… |
| å¿ƒç†ãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚° | âŒ | âœ… | âœ… |
| çµ±è¨ˆè¡¨ç¤º | âŒ | âœ… | âœ… |
| ãƒ–ãƒ­ãƒƒã‚¯æ©Ÿèƒ½ | âŒ | âœ… | âœ… |

**æ³¨**: ç„¡æ–™æ©Ÿèƒ½ãªã—ã€‚ã‚ªãƒ³ãƒœãƒ¼ãƒ‡ã‚£ãƒ³ã‚°å®Œäº†æ™‚ã«è‡ªå‹•ã§ãƒˆãƒ©ã‚¤ã‚¢ãƒ«é–‹å§‹ã€‚

### 10.6 å®Ÿè£…æ™‚ã®æ³¨æ„ç‚¹

1. **Shieldç”»é¢**: `useSubscriptionAccess()` ã§ `hasFullAccess` ã‚’ç¢ºèª
2. **AIã‚¿ãƒ–**: ã‚¢ã‚¯ã‚»ã‚¹å‰ã«èª²é‡‘çŠ¶æ…‹ã‚’ãƒã‚§ãƒƒã‚¯
3. **ãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°ç”»é¢**: åŒä¸Š
4. **è¨­å®šç”»é¢**: ç¾åœ¨ã®ãƒ—ãƒ©ãƒ³ãƒ»æœŸé™ã‚’è¡¨ç¤º
